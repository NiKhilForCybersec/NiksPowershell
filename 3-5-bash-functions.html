<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3.5 Bash Functions & Scripts - PowerShell & Scripting Guide</title>
    <link rel="stylesheet" href="main.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
</head>
<body>
    <div class="layout-wrapper">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo">
                    <div class="sidebar-logo-icon">üñ•Ô∏è</div>
                    <div class="sidebar-logo-text">
                        PowerShell & Scripting
                        <span>Ultimate Guide</span>
                    </div>
                </div>
                <div class="search-container">
                    <span class="search-icon">üîç</span>
                    <input type="text" class="search-input" placeholder="Search documentation...">
                    <span class="search-shortcut">Ctrl+K</span>
                </div>
            </div>
            
            <nav class="sidebar-nav">
                <div class="nav-section" data-section="bash">
                    <div class="nav-section-header">
                        <span class="nav-section-icon">üêß</span>
                        Bash Scripting
                        <span class="nav-section-toggle">‚ñº</span>
                    </div>
                    <div class="nav-section-content">
                        <a href="3-1-bash-intro.html" class="nav-link"><span class="nav-link-number">3.1</span> Bash Introduction</a>
                        <a href="3-5-bash-functions.html" class="nav-link active"><span class="nav-link-number">3.5</span> Functions & Scripts</a>
                        <a href="3-10-text-processing.html" class="nav-link"><span class="nav-link-number">3.10</span> Text Processing</a>
                        <a href="3-12-bash-networking.html" class="nav-link"><span class="nav-link-number">3.12</span> Bash Networking</a>
                    </div>
                </div>

                <div class="nav-section collapsed" data-section="security">
                    <div class="nav-section-header">
                        <span class="nav-section-icon">üîí</span>
                        Security Automation
                        <span class="nav-section-toggle">‚ñº</span>
                    </div>
                    <div class="nav-section-content">
                        <a href="5-6-incident-response-scripts.html" class="nav-link"><span class="nav-link-number">5.6</span> Incident Response Scripts</a>
                    </div>
                </div>

                <div class="nav-section collapsed" data-section="reference">
                    <div class="nav-section-header">
                        <span class="nav-section-icon">üìã</span>
                        Best Practices & Reference
                        <span class="nav-section-toggle">‚ñº</span>
                    </div>
                    <div class="nav-section-content">
                        <a href="10-5-cheat-sheets.html" class="nav-link"><span class="nav-link-number">10.5</span> Cheat Sheets</a>
                        <a href="10-6-interview-preparation.html" class="nav-link"><span class="nav-link-number">10.6</span> Interview Preparation</a>
                        <a href="10-7-log-paths-reference.html" class="nav-link"><span class="nav-link-number">10.7</span> Log Paths Reference</a>
                    </div>
                </div>
            </nav>
        </aside>

        <!-- Main Content Area -->
        <main class="main-content">
            <div class="content-wrapper">
                <!-- Breadcrumb -->
                <nav class="breadcrumb">
                    <a href="index.html">Home</a>
                    <span class="breadcrumb-separator">‚Ä∫</span>
                    <a href="index.html#bash">Bash Scripting</a>
                    <span class="breadcrumb-separator">‚Ä∫</span>
                    <span>Functions & Scripts</span>
                </nav>

                <!-- Page Title -->
                <h1>3.5 Bash Functions & Scripts</h1>

                <!-- What You'll Learn Box -->
                <div class="info-box overview-box">
                    <div class="info-box-header">
                        <div class="info-box-icon">üìñ</div>
                        <div class="info-box-title">What You'll Learn</div>
                    </div>
                    <ul>
                        <li>Create and organize Bash functions</li>
                        <li>Build robust scripts with proper argument handling</li>
                        <li>Implement error handling and logging</li>
                        <li>Write security-focused automation scripts</li>
                    </ul>
                </div>

                <!-- Introduction -->
                <h2>Building Reusable Bash Code</h2>
                <p>
                    Functions are the building blocks of maintainable Bash scripts. They allow you 
                    to organize code into logical units, improve readability, and create reusable 
                    components for security automation tasks.
                </p>

                <!-- Memory Aid -->
                <div class="info-box memory-box">
                    <div class="info-box-header">
                        <div class="info-box-icon">üß†</div>
                        <div class="info-box-title">Memory Aid: Function Basics</div>
                    </div>
                    <ul>
                        <li><strong>$1, $2, $3...</strong> ‚Üí Positional parameters (arguments)</li>
                        <li><strong>$@</strong> ‚Üí All arguments as separate words</li>
                        <li><strong>$#</strong> ‚Üí Number of arguments</li>
                        <li><strong>$?</strong> ‚Üí Exit status of last command (0 = success)</li>
                        <li><strong>$0</strong> ‚Üí Script name</li>
                        <li><strong>local</strong> ‚Üí Declare local variables (avoid global pollution)</li>
                    </ul>
                </div>

                <!-- Basic Functions -->
                <h2>Function Syntax</h2>

                <div class="code-container">
                    <div class="code-header">
                        <span class="code-language bash">
                            <span class="code-language-icon">üêß</span>
                            Bash - Function Basics
                        </span>
                        <button class="code-copy-btn"><span>üìã</span> Copy</button>
                    </div>
                    <div class="code-block">
<pre><code><span class="token-comment">#!/bin/bash</span>

<span class="token-comment"># Method 1: Traditional syntax</span>
<span class="token-keyword">function</span> <span class="token-function">greet</span>() {
    <span class="token-function">echo</span> <span class="token-string">"Hello, $1!"</span>
}

<span class="token-comment"># Method 2: POSIX-compliant (preferred for portability)</span>
<span class="token-function">greet_v2</span>() {
    <span class="token-function">echo</span> <span class="token-string">"Hello, $1!"</span>
}

<span class="token-comment"># Call functions</span>
greet <span class="token-string">"World"</span>
greet_v2 <span class="token-string">"Security Team"</span>

<span class="token-comment"># Function with multiple parameters</span>
<span class="token-function">log_event</span>() {
    <span class="token-keyword">local</span> level=<span class="token-string">"$1"</span>
    <span class="token-keyword">local</span> message=<span class="token-string">"$2"</span>
    <span class="token-keyword">local</span> timestamp=<span class="token-variable">$(</span><span class="token-function">date</span> <span class="token-string">'+%Y-%m-%d %H:%M:%S'</span><span class="token-variable">)</span>
    
    <span class="token-function">echo</span> <span class="token-string">"[$timestamp] [$level] $message"</span>
}

log_event <span class="token-string">"INFO"</span> <span class="token-string">"Script started"</span>
log_event <span class="token-string">"ERROR"</span> <span class="token-string">"Connection failed"</span>

<span class="token-comment"># Function with return value (exit code)</span>
<span class="token-function">is_root</span>() {
    [[ <span class="token-variable">$(</span><span class="token-function">id</span> -u<span class="token-variable">)</span> -eq 0 ]]
    <span class="token-keyword">return</span> <span class="token-variable">$?</span>
}

<span class="token-keyword">if</span> is_root; <span class="token-keyword">then</span>
    <span class="token-function">echo</span> <span class="token-string">"Running as root"</span>
<span class="token-keyword">else</span>
    <span class="token-function">echo</span> <span class="token-string">"Not running as root"</span>
<span class="token-keyword">fi</span>

<span class="token-comment"># Function that returns data via stdout</span>
<span class="token-function">get_ip</span>() {
    <span class="token-function">curl</span> -s ifconfig.me
}

my_ip=<span class="token-variable">$(</span>get_ip<span class="token-variable">)</span>
<span class="token-function">echo</span> <span class="token-string">"My IP: $my_ip"</span></code></pre>
                    </div>
                </div>

                <!-- Local Variables -->
                <h2>Variable Scope</h2>

                <div class="code-container">
                    <div class="code-header">
                        <span class="code-language bash">
                            <span class="code-language-icon">üêß</span>
                            Bash - Variable Scope
                        </span>
                        <button class="code-copy-btn"><span>üìã</span> Copy</button>
                    </div>
                    <div class="code-block">
<pre><code><span class="token-comment">#!/bin/bash</span>

<span class="token-comment"># Global variable</span>
GLOBAL_VAR=<span class="token-string">"I'm global"</span>

<span class="token-function">demo_scope</span>() {
    <span class="token-comment"># Local variable (only exists inside function)</span>
    <span class="token-keyword">local</span> local_var=<span class="token-string">"I'm local"</span>
    
    <span class="token-comment"># Without 'local', this modifies the global scope</span>
    leaked_var=<span class="token-string">"I leaked to global!"</span>
    
    <span class="token-function">echo</span> <span class="token-string">"Inside function:"</span>
    <span class="token-function">echo</span> <span class="token-string">"  Global: $GLOBAL_VAR"</span>
    <span class="token-function">echo</span> <span class="token-string">"  Local: $local_var"</span>
}

demo_scope

<span class="token-function">echo</span> <span class="token-string">"Outside function:"</span>
<span class="token-function">echo</span> <span class="token-string">"  Global: $GLOBAL_VAR"</span>
<span class="token-function">echo</span> <span class="token-string">"  Local: $local_var"</span>        <span class="token-comment"># Empty - local scope ended</span>
<span class="token-function">echo</span> <span class="token-string">"  Leaked: $leaked_var"</span>      <span class="token-comment"># Still exists!</span>

<span class="token-comment"># Best Practice: Always use 'local' for function variables</span>
<span class="token-function">process_file</span>() {
    <span class="token-keyword">local</span> file=<span class="token-string">"$1"</span>
    <span class="token-keyword">local</span> count=0
    <span class="token-keyword">local</span> line
    
    <span class="token-keyword">while</span> IFS= <span class="token-function">read</span> -r line; <span class="token-keyword">do</span>
        (( count++ ))
    <span class="token-keyword">done</span> < <span class="token-string">"$file"</span>
    
    <span class="token-function">echo</span> <span class="token-string">"$count"</span>
}</code></pre>
                    </div>
                </div>

                <!-- Script Structure -->
                <h2>Professional Script Structure</h2>

                <div class="code-container">
                    <div class="code-header">
                        <span class="code-language bash">
                            <span class="code-language-icon">üêß</span>
                            Bash - Script Template
                        </span>
                        <button class="code-copy-btn"><span>üìã</span> Copy</button>
                    </div>
                    <div class="code-block">
<pre><code><span class="token-comment">#!/bin/bash</span>
<span class="token-comment">#</span>
<span class="token-comment"># Script: security_scan.sh</span>
<span class="token-comment"># Description: Performs security checks on target hosts</span>
<span class="token-comment"># Author: Security Team</span>
<span class="token-comment"># Version: 1.0</span>
<span class="token-comment">#</span>

<span class="token-comment"># Exit on error, undefined variables, and pipe failures</span>
<span class="token-function">set</span> -euo pipefail

<span class="token-comment"># Constants</span>
<span class="token-keyword">readonly</span> SCRIPT_NAME=<span class="token-string">"$(basename "$0")"</span>
<span class="token-keyword">readonly</span> SCRIPT_DIR=<span class="token-string">"$(cd "$(dirname "$0")" && pwd)"</span>
<span class="token-keyword">readonly</span> LOG_FILE=<span class="token-string">"/var/log/security_scan.log"</span>

<span class="token-comment"># Default values</span>
VERBOSE=false
DRY_RUN=false
TARGET=<span class="token-string">""</span>

<span class="token-comment"># =============================================================================</span>
<span class="token-comment"># FUNCTIONS</span>
<span class="token-comment"># =============================================================================</span>

<span class="token-function">usage</span>() {
    <span class="token-function">cat</span> &lt;&lt;EOF
Usage: <span class="token-variable">$SCRIPT_NAME</span> [OPTIONS] TARGET

Perform security scan on target host.

Options:
    -h, --help      Show this help message
    -v, --verbose   Enable verbose output
    -n, --dry-run   Show what would be done without executing
    -o, --output    Output file for results

Examples:
    <span class="token-variable">$SCRIPT_NAME</span> 192.168.1.1
    <span class="token-variable">$SCRIPT_NAME</span> -v --output results.txt 10.0.0.0/24

EOF
    <span class="token-function">exit</span> 0
}

<span class="token-function">log</span>() {
    <span class="token-keyword">local</span> level=<span class="token-string">"$1"</span>
    <span class="token-function">shift</span>
    <span class="token-keyword">local</span> message=<span class="token-string">"$*"</span>
    <span class="token-keyword">local</span> timestamp=<span class="token-variable">$(</span><span class="token-function">date</span> <span class="token-string">'+%Y-%m-%d %H:%M:%S'</span><span class="token-variable">)</span>
    
    <span class="token-function">echo</span> <span class="token-string">"[$timestamp] [$level] $message"</span> | <span class="token-function">tee</span> -a <span class="token-string">"$LOG_FILE"</span>
}

<span class="token-function">info</span>()    { log <span class="token-string">"INFO"</span> <span class="token-string">"$@"</span>; }
<span class="token-function">warn</span>()    { log <span class="token-string">"WARN"</span> <span class="token-string">"$@"</span> >&2; }
<span class="token-function">error</span>()   { log <span class="token-string">"ERROR"</span> <span class="token-string">"$@"</span> >&2; }
<span class="token-function">debug</span>()   { [[ <span class="token-string">"$VERBOSE"</span> == true ]] && log <span class="token-string">"DEBUG"</span> <span class="token-string">"$@"</span>; }

<span class="token-function">die</span>() {
    error <span class="token-string">"$@"</span>
    <span class="token-function">exit</span> 1
}

<span class="token-function">cleanup</span>() {
    <span class="token-comment"># Cleanup temporary files on exit</span>
    info <span class="token-string">"Cleaning up..."</span>
    <span class="token-function">rm</span> -f /tmp/scan_*.tmp 2>/dev/null || true
}

<span class="token-function">parse_args</span>() {
    <span class="token-keyword">while</span> [[ $# -gt 0 ]]; <span class="token-keyword">do</span>
        <span class="token-keyword">case</span> <span class="token-string">"$1"</span> <span class="token-keyword">in</span>
            -h|--help)
                usage
                ;;
            -v|--verbose)
                VERBOSE=true
                <span class="token-function">shift</span>
                ;;
            -n|--dry-run)
                DRY_RUN=true
                <span class="token-function">shift</span>
                ;;
            -o|--output)
                OUTPUT_FILE=<span class="token-string">"$2"</span>
                <span class="token-function">shift</span> 2
                ;;
            -*)
                die <span class="token-string">"Unknown option: $1"</span>
                ;;
            *)
                TARGET=<span class="token-string">"$1"</span>
                <span class="token-function">shift</span>
                ;;
        <span class="token-keyword">esac</span>
    <span class="token-keyword">done</span>
    
    <span class="token-comment"># Validate required arguments</span>
    [[ -z <span class="token-string">"$TARGET"</span> ]] && die <span class="token-string">"TARGET is required. Use -h for help."</span>
}

<span class="token-function">check_dependencies</span>() {
    <span class="token-keyword">local</span> deps=(nmap curl jq)
    
    <span class="token-keyword">for</span> cmd <span class="token-keyword">in</span> <span class="token-string">"${deps[@]}"</span>; <span class="token-keyword">do</span>
        <span class="token-keyword">if</span> ! <span class="token-function">command</span> -v <span class="token-string">"$cmd"</span> &>/dev/null; <span class="token-keyword">then</span>
            die <span class="token-string">"Required command not found: $cmd"</span>
        <span class="token-keyword">fi</span>
    <span class="token-keyword">done</span>
    
    debug <span class="token-string">"All dependencies satisfied"</span>
}

<span class="token-function">perform_scan</span>() {
    <span class="token-keyword">local</span> target=<span class="token-string">"$1"</span>
    
    info <span class="token-string">"Starting scan on $target"</span>
    
    <span class="token-keyword">if</span> [[ <span class="token-string">"$DRY_RUN"</span> == true ]]; <span class="token-keyword">then</span>
        info <span class="token-string">"[DRY RUN] Would scan: $target"</span>
        <span class="token-keyword">return</span> 0
    <span class="token-keyword">fi</span>
    
    <span class="token-comment"># Actual scan logic here</span>
    debug <span class="token-string">"Running nmap scan..."</span>
    <span class="token-function">nmap</span> -sT -F <span class="token-string">"$target"</span>
}

<span class="token-comment"># =============================================================================</span>
<span class="token-comment"># MAIN</span>
<span class="token-comment"># =============================================================================</span>

<span class="token-function">main</span>() {
    <span class="token-comment"># Set up trap for cleanup</span>
    <span class="token-function">trap</span> cleanup EXIT
    
    parse_args <span class="token-string">"$@"</span>
    check_dependencies
    
    info <span class="token-string">"=== Security Scan Starting ==="</span>
    debug <span class="token-string">"Target: $TARGET"</span>
    debug <span class="token-string">"Verbose: $VERBOSE"</span>
    
    perform_scan <span class="token-string">"$TARGET"</span>
    
    info <span class="token-string">"=== Scan Complete ==="</span>
}

<span class="token-comment"># Only run main if script is executed (not sourced)</span>
<span class="token-keyword">if</span> [[ <span class="token-string">"${BASH_SOURCE[0]}"</span> == <span class="token-string">"${0}"</span> ]]; <span class="token-keyword">then</span>
    main <span class="token-string">"$@"</span>
<span class="token-keyword">fi</span></code></pre>
                    </div>
                </div>

                <!-- Error Handling -->
                <h2>Error Handling</h2>

                <div class="code-container">
                    <div class="code-header">
                        <span class="code-language bash">
                            <span class="code-language-icon">üêß</span>
                            Bash - Error Handling
                        </span>
                        <button class="code-copy-btn"><span>üìã</span> Copy</button>
                    </div>
                    <div class="code-block">
<pre><code><span class="token-comment">#!/bin/bash</span>
<span class="token-function">set</span> -euo pipefail

<span class="token-comment"># set -e: Exit on error</span>
<span class="token-comment"># set -u: Error on undefined variables</span>
<span class="token-comment"># set -o pipefail: Exit on pipe failures</span>

<span class="token-comment"># Method 1: Check return codes explicitly</span>
<span class="token-function">safe_download</span>() {
    <span class="token-keyword">local</span> url=<span class="token-string">"$1"</span>
    <span class="token-keyword">local</span> output=<span class="token-string">"$2"</span>
    
    <span class="token-keyword">if</span> <span class="token-function">curl</span> -sS -o <span class="token-string">"$output"</span> <span class="token-string">"$url"</span>; <span class="token-keyword">then</span>
        <span class="token-function">echo</span> <span class="token-string">"Downloaded successfully: $output"</span>
        <span class="token-keyword">return</span> 0
    <span class="token-keyword">else</span>
        <span class="token-function">echo</span> <span class="token-string">"Download failed: $url"</span> >&2
        <span class="token-keyword">return</span> 1
    <span class="token-keyword">fi</span>
}

<span class="token-comment"># Method 2: Using || for fallback</span>
<span class="token-function">get_user_input</span>() {
    <span class="token-function">read</span> -r -p <span class="token-string">"Enter value: "</span> value || value=<span class="token-string">"default"</span>
    <span class="token-function">echo</span> <span class="token-string">"$value"</span>
}

<span class="token-comment"># Method 3: Trap errors globally</span>
<span class="token-function">error_handler</span>() {
    <span class="token-keyword">local</span> exit_code=<span class="token-variable">$?</span>
    <span class="token-keyword">local</span> line_no=<span class="token-variable">$1</span>
    <span class="token-function">echo</span> <span class="token-string">"Error on line $line_no. Exit code: $exit_code"</span> >&2
}
<span class="token-function">trap</span> <span class="token-string">'error_handler $LINENO'</span> ERR

<span class="token-comment"># Method 4: Try-catch pattern</span>
<span class="token-function">try_catch</span>() {
    <span class="token-keyword">local</span> output
    
    <span class="token-comment"># Temporarily disable exit on error</span>
    <span class="token-function">set</span> +e
    output=<span class="token-variable">$(</span>some_risky_command 2>&1<span class="token-variable">)</span>
    <span class="token-keyword">local</span> status=<span class="token-variable">$?</span>
    <span class="token-function">set</span> -e
    
    <span class="token-keyword">if</span> [[ <span class="token-variable">$status</span> -ne 0 ]]; <span class="token-keyword">then</span>
        <span class="token-function">echo</span> <span class="token-string">"Command failed: $output"</span> >&2
        <span class="token-keyword">return</span> 1
    <span class="token-keyword">fi</span>
    
    <span class="token-function">echo</span> <span class="token-string">"$output"</span>
}

<span class="token-comment"># Method 5: Default values for undefined variables</span>
<span class="token-function">use_defaults</span>() {
    <span class="token-keyword">local</span> name=<span class="token-string">"${1:-Unknown}"</span>      <span class="token-comment"># Default if $1 is unset/empty</span>
    <span class="token-keyword">local</span> port=<span class="token-string">"${2:-22}"</span>
    <span class="token-keyword">local</span> timeout=<span class="token-string">"${TIMEOUT:-30}"</span>   <span class="token-comment"># Environment variable with default</span>
    
    <span class="token-function">echo</span> <span class="token-string">"Connecting to $name:$port (timeout: ${timeout}s)"</span>
}</code></pre>
                    </div>
                </div>

                <!-- Security Functions -->
                <h2>Security-Focused Functions</h2>

                <div class="code-container">
                    <div class="code-header">
                        <span class="code-language bash">
                            <span class="code-language-icon">üêß</span>
                            Bash - Security Functions Library
                        </span>
                        <button class="code-copy-btn"><span>üìã</span> Copy</button>
                    </div>
                    <div class="code-block">
<pre><code><span class="token-comment">#!/bin/bash</span>
<span class="token-comment"># security_lib.sh - Common security functions</span>

<span class="token-comment"># Check if running as root</span>
<span class="token-function">require_root</span>() {
    <span class="token-keyword">if</span> [[ <span class="token-string">"$(id -u)"</span> -ne 0 ]]; <span class="token-keyword">then</span>
        <span class="token-function">echo</span> <span class="token-string">"Error: This script must be run as root"</span> >&2
        <span class="token-function">exit</span> 1
    <span class="token-keyword">fi</span>
}

<span class="token-comment"># Validate IP address format</span>
<span class="token-function">is_valid_ip</span>() {
    <span class="token-keyword">local</span> ip=<span class="token-string">"$1"</span>
    <span class="token-keyword">local</span> regex=<span class="token-string">'^([0-9]{1,3}\.){3}[0-9]{1,3}$'</span>
    
    <span class="token-keyword">if</span> [[ <span class="token-variable">$ip</span> =~ <span class="token-variable">$regex</span> ]]; <span class="token-keyword">then</span>
        <span class="token-comment"># Verify each octet is 0-255</span>
        IFS=<span class="token-string">'.'</span> <span class="token-function">read</span> -ra octets <<< <span class="token-string">"$ip"</span>
        <span class="token-keyword">for</span> octet <span class="token-keyword">in</span> <span class="token-string">"${octets[@]}"</span>; <span class="token-keyword">do</span>
            [[ <span class="token-variable">$octet</span> -gt 255 ]] && <span class="token-keyword">return</span> 1
        <span class="token-keyword">done</span>
        <span class="token-keyword">return</span> 0
    <span class="token-keyword">fi</span>
    <span class="token-keyword">return</span> 1
}

<span class="token-comment"># Get file hash (SHA256)</span>
<span class="token-function">get_hash</span>() {
    <span class="token-keyword">local</span> file=<span class="token-string">"$1"</span>
    <span class="token-keyword">local</span> algo=<span class="token-string">"${2:-sha256}"</span>
    
    <span class="token-keyword">if</span> [[ ! -f <span class="token-string">"$file"</span> ]]; <span class="token-keyword">then</span>
        <span class="token-function">echo</span> <span class="token-string">"File not found: $file"</span> >&2
        <span class="token-keyword">return</span> 1
    <span class="token-keyword">fi</span>
    
    <span class="token-keyword">case</span> <span class="token-string">"$algo"</span> <span class="token-keyword">in</span>
        md5)    <span class="token-function">md5sum</span> <span class="token-string">"$file"</span> | <span class="token-function">awk</span> <span class="token-string">'{print $1}'</span> ;;
        sha1)   <span class="token-function">sha1sum</span> <span class="token-string">"$file"</span> | <span class="token-function">awk</span> <span class="token-string">'{print $1}'</span> ;;
        sha256) <span class="token-function">sha256sum</span> <span class="token-string">"$file"</span> | <span class="token-function">awk</span> <span class="token-string">'{print $1}'</span> ;;
        *)      <span class="token-function">echo</span> <span class="token-string">"Unknown algorithm: $algo"</span> >&2; <span class="token-keyword">return</span> 1 ;;
    <span class="token-keyword">esac</span>
}

<span class="token-comment"># Sanitize user input (remove dangerous characters)</span>
<span class="token-function">sanitize_input</span>() {
    <span class="token-keyword">local</span> input=<span class="token-string">"$1"</span>
    <span class="token-comment"># Remove shell metacharacters</span>
    <span class="token-function">echo</span> <span class="token-string">"$input"</span> | <span class="token-function">sed</span> <span class="token-string">'s/[;&|`$(){}\\]//g'</span>
}

<span class="token-comment"># Check if port is open (local)</span>
<span class="token-function">is_port_open</span>() {
    <span class="token-keyword">local</span> port=<span class="token-string">"$1"</span>
    <span class="token-function">ss</span> -tln | <span class="token-function">grep</span> -q <span class="token-string">":$port "</span>
}

<span class="token-comment"># Get open ports</span>
<span class="token-function">get_open_ports</span>() {
    <span class="token-function">ss</span> -tlnp 2>/dev/null | <span class="token-function">awk</span> <span class="token-string">'NR>1 {print $4}'</span> | \
        <span class="token-function">grep</span> -oE <span class="token-string">'[0-9]+$'</span> | <span class="token-function">sort</span> -nu
}

<span class="token-comment"># Check if process is running</span>
<span class="token-function">is_process_running</span>() {
    <span class="token-keyword">local</span> process=<span class="token-string">"$1"</span>
    <span class="token-function">pgrep</span> -x <span class="token-string">"$process"</span> &>/dev/null
}

<span class="token-comment"># Create secure temporary directory</span>
<span class="token-function">create_secure_temp</span>() {
    <span class="token-keyword">local</span> temp_dir
    temp_dir=<span class="token-variable">$(</span><span class="token-function">mktemp</span> -d -t secure_XXXXXX<span class="token-variable">)</span>
    <span class="token-function">chmod</span> 700 <span class="token-string">"$temp_dir"</span>
    <span class="token-function">echo</span> <span class="token-string">"$temp_dir"</span>
}

<span class="token-comment"># Example usage</span>
<span class="token-keyword">if</span> [[ <span class="token-string">"${BASH_SOURCE[0]}"</span> == <span class="token-string">"${0}"</span> ]]; <span class="token-keyword">then</span>
    <span class="token-function">echo</span> <span class="token-string">"Testing security functions..."</span>
    
    is_valid_ip <span class="token-string">"192.168.1.1"</span> && <span class="token-function">echo</span> <span class="token-string">"Valid IP"</span>
    is_valid_ip <span class="token-string">"999.999.999.999"</span> || <span class="token-function">echo</span> <span class="token-string">"Invalid IP"</span>
    
    <span class="token-function">echo</span> <span class="token-string">"Hash of $0: $(get_hash "$0")"</span>
    <span class="token-function">echo</span> <span class="token-string">"Open ports: $(get_open_ports | tr '\n' ' ')"</span>
<span class="token-keyword">fi</span></code></pre>
                    </div>
                </div>

                <!-- Best Practices -->
                <div class="info-box best-practice-box">
                    <div class="info-box-header">
                        <div class="info-box-icon">‚úÖ</div>
                        <div class="info-box-title">Best Practices: Bash Functions</div>
                    </div>
                    <ul>
                        <li><strong>Use <code>local</code> for all variables:</strong> Prevents scope leakage</li>
                        <li><strong>Quote all variables:</strong> <code>"$var"</code> prevents word splitting</li>
                        <li><strong>Use <code>set -euo pipefail</code>:</strong> Fail fast on errors</li>
                        <li><strong>Validate inputs:</strong> Check arguments before processing</li>
                        <li><strong>Use <code>[[ ]]</code> for tests:</strong> More robust than <code>[ ]</code></li>
                        <li><strong>Document functions:</strong> Add comments explaining purpose</li>
                        <li><strong>Return meaningful codes:</strong> 0 for success, non-zero for errors</li>
                    </ul>
                </div>

                <!-- Interview Tips -->
                <div class="info-box interview-box">
                    <div class="info-box-header">
                        <div class="info-box-icon">üíº</div>
                        <div class="info-box-title">Interview Tips</div>
                    </div>
                    <ul>
                        <li><strong>Common Question:</strong> "What does <code>set -euo pipefail</code> do?"</li>
                        <li><strong>Strong Answer:</strong> <code>-e</code> exits immediately on error, <code>-u</code> treats undefined variables as errors, <code>-o pipefail</code> makes pipelines fail if any command fails (not just the last one). This creates more robust scripts that fail fast rather than silently continuing after errors.</li>
                        <li><strong>Follow-up:</strong> Explain when you might need to temporarily disable with <code>set +e</code> for commands that are expected to fail.</li>
                    </ul>
                </div>

                <!-- Key Takeaways -->
                <h2>Key Takeaways</h2>
                <ul>
                    <li>Always use <code>local</code> keyword for function variables</li>
                    <li>Use <code>set -euo pipefail</code> for safer scripts</li>
                    <li>Structure scripts with functions, constants, and a main() entry point</li>
                    <li>Implement proper argument parsing with usage instructions</li>
                    <li>Use traps for cleanup on exit or error</li>
                    <li>Quote variables to prevent word splitting and globbing issues</li>
                </ul>

                <!-- Navigation -->
                <div class="page-navigation">
                    <a href="3-4-control-structures.html" class="nav-button prev">
                        <span class="nav-button-label">Previous</span>
                        <span class="nav-button-title">‚Üê 3.4 Control Structures</span>
                    </a>
                    <a href="3-6-file-operations.html" class="nav-button next">
                        <span class="nav-button-label">Next</span>
                        <span class="nav-button-title">3.6 File Operations ‚Üí</span>
                    </a>
                </div>
            </div>
        </main>
    </div>

    <!-- Search Modal -->
    <div class="search-modal" id="searchModal">
        <div class="search-modal-content">
            <input type="text" class="search-modal-input" id="searchModalInput" placeholder="Search documentation..." autocomplete="off">
            <div class="search-modal-results" id="searchResults"></div>
        </div>
    </div>

    <!-- Mobile Toggle -->
    <button class="mobile-toggle">‚ò∞</button>

    <script src="main.js"></script>
</body>
</html>
