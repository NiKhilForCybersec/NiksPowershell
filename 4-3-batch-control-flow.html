<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>4.3 Batch Control Flow - PowerShell & Scripting Guide</title>
    <link rel="stylesheet" href="main.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
</head>
<body>
    <div class="layout-wrapper">
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo">
                    <div class="sidebar-logo-icon">üñ•Ô∏è</div>
                    <div class="sidebar-logo-text">
                        PowerShell & Scripting
                        <span>Ultimate Guide</span>
                    </div>
                </div>
                <div class="search-container">
                    <span class="search-icon">üîç</span>
                    <input type="text" class="search-input" placeholder="Search documentation...">
                    <span class="search-shortcut">Ctrl+K</span>
                </div>
            </div>
            <nav class="sidebar-nav">
                <!-- Section 1: Scripting Fundamentals -->
                <div class="nav-section" data-section="fundamentals">
                    <div class="nav-section-header">
                        <span class="nav-section-icon">üìö</span>
                        Scripting Fundamentals
                        <span class="nav-section-toggle">‚ñº</span>
                    </div>
                    <div class="nav-section-content">
                        <a href="1-1-scripting-overview.html" class="nav-link"><span class="nav-link-number">1.1</span> Scripting Overview</a>
                        <a href="1-2-choosing-right-tool.html" class="nav-link"><span class="nav-link-number">1.2</span> Choosing the Right Tool</a>
                        <a href="1-3-setting-up-environment.html" class="nav-link"><span class="nav-link-number">1.3</span> Setting Up Environment</a>
                    </div>
                </div>

                <!-- Section 2: PowerShell Deep Dive -->
                <div class="nav-section" data-section="powershell">
                    <div class="nav-section-header">
                        <span class="nav-section-icon">üî∑</span>
                        PowerShell Deep Dive
                        <span class="nav-section-toggle">‚ñº</span>
                    </div>
                    <div class="nav-section-content">
                        <a href="2-1-powershell-intro.html" class="nav-link"><span class="nav-link-number">2.1</span> PowerShell Introduction</a>
                        <a href="2-2-cmdlet-anatomy.html" class="nav-link"><span class="nav-link-number">2.2</span> Cmdlet Anatomy</a>
                        <a href="2-3-pipeline-mastery.html" class="nav-link"><span class="nav-link-number">2.3</span> Pipeline Mastery</a>
                        <a href="2-4-variables-data-types.html" class="nav-link"><span class="nav-link-number">2.4</span> Variables & Data Types</a>
                        <a href="2-5-working-with-objects.html" class="nav-link"><span class="nav-link-number">2.5</span> Working with Objects</a>
                        <a href="2-6-control-structures.html" class="nav-link"><span class="nav-link-number">2.6</span> Control Structures</a>
                        <a href="2-7-functions.html" class="nav-link"><span class="nav-link-number">2.7</span> Functions</a>
                        <a href="2-8-files.html" class="nav-link"><span class="nav-link-number">2.8</span> Working with Files</a>
                        <a href="2-9-wmi-cim.html" class="nav-link"><span class="nav-link-number">2.9</span> WMI & CIM</a>
                        <a href="2-10-registry.html" class="nav-link"><span class="nav-link-number">2.10</span> Registry Operations</a>
                        <a href="2-11-eventlog-analysis.html" class="nav-link"><span class="nav-link-number">2.11</span> Event Log Analysis</a>
                        <a href="2-12-active-directory.html" class="nav-link"><span class="nav-link-number">2.12</span> Active Directory</a>
                        <a href="2-13-networking-commands.html" class="nav-link"><span class="nav-link-number">2.13</span> Networking Commands</a>
                        <a href="2-14-web-requests.html" class="nav-link"><span class="nav-link-number">2.14</span> Web Requests & APIs</a>
                        <a href="2-15-remoting-jobs.html" class="nav-link"><span class="nav-link-number">2.15</span> Remoting & Jobs</a>
                        <a href="2-16-error-handling.html" class="nav-link"><span class="nav-link-number">2.16</span> Error Handling</a>
                        <a href="2-17-modules-profiles.html" class="nav-link"><span class="nav-link-number">2.17</span> Modules & Profiles</a>
                    </div>
                </div>

                <!-- Section 3: Bash Scripting -->
                <div class="nav-section" data-section="bash">
                    <div class="nav-section-header">
                        <span class="nav-section-icon">üêß</span>
                        Bash Scripting
                        <span class="nav-section-toggle">‚ñº</span>
                    </div>
                    <div class="nav-section-content">
                        <a href="3-1-bash-intro.html" class="nav-link"><span class="nav-link-number">3.1</span> Bash Introduction</a>
                        <a href="3-2-bash-variables.html" class="nav-link"><span class="nav-link-number">3.2</span> Variables & Data Types</a>
                        <a href="3-3-control-structures.html" class="nav-link"><span class="nav-link-number">3.3</span> Control Structures</a>
                        <a href="3-4-bash-functions.html" class="nav-link"><span class="nav-link-number">3.4</span> Functions & Scripts</a>
                        <a href="3-5-file-io.html" class="nav-link"><span class="nav-link-number">3.5</span> File I/O</a>
                        <a href="3-6-process-management.html" class="nav-link"><span class="nav-link-number">3.6</span> Process Management</a>
                        <a href="3-7-system-admin.html" class="nav-link"><span class="nav-link-number">3.7</span> System Administration</a>
                        <a href="3-8-regex.html" class="nav-link"><span class="nav-link-number">3.8</span> Regular Expressions</a>
                        <a href="3-9-text-processing.html" class="nav-link"><span class="nav-link-number">3.9</span> Text Processing</a>
                        <a href="3-10-bash-networking.html" class="nav-link"><span class="nav-link-number">3.10</span> Bash Networking</a>
                    </div>
                </div>

                <!-- Section 4: Batch/CMD Scripting -->
                <div class="nav-section" data-section="batch">
                    <div class="nav-section-header">
                        <span class="nav-section-icon">üì¶</span>
                        Batch/CMD Scripting
                        <span class="nav-section-toggle">‚ñº</span>
                    </div>
                    <div class="nav-section-content">
                        <a href="4-1-batch-intro.html" class="nav-link"><span class="nav-link-number">4.1</span> Batch Introduction</a>
                        <a href="4-2-batch-variables.html" class="nav-link"><span class="nav-link-number">4.2</span> Variables & Parameters</a>
                        <a href="4-3-batch-control-flow.html" class="nav-link"><span class="nav-link-number">4.3</span> Control Flow</a>
                        <a href="4-4-batch-file-operations.html" class="nav-link"><span class="nav-link-number">4.4</span> File Operations</a>
                    </div>
                </div>

                <!-- Section 5: Security Automation -->
                <div class="nav-section" data-section="security">
                    <div class="nav-section-header">
                        <span class="nav-section-icon">üõ°Ô∏è</span>
                        Security Automation
                        <span class="nav-section-toggle">‚ñº</span>
                    </div>
                    <div class="nav-section-content">
                        <a href="5-1-incident-response.html" class="nav-link"><span class="nav-link-number">5.1</span> Incident Response</a>
                        <a href="5-2-threat-hunting.html" class="nav-link"><span class="nav-link-number">5.2</span> Threat Hunting</a>
                        <a href="5-3-vulnerability-scanning.html" class="nav-link"><span class="nav-link-number">5.3</span> Vulnerability Scanning</a>
                        <a href="5-4-forensics-scripts.html" class="nav-link"><span class="nav-link-number">5.4</span> Forensics Scripts</a>
                        <a href="5-5-siem-integration.html" class="nav-link"><span class="nav-link-number">5.5</span> SIEM Integration</a>
                        <a href="5-6-edr-automation.html" class="nav-link"><span class="nav-link-number">5.6</span> EDR Automation</a>
                        <a href="5-7-compliance-automation.html" class="nav-link"><span class="nav-link-number">5.7</span> Compliance Automation</a>
                        <a href="5-8-log-analysis.html" class="nav-link"><span class="nav-link-number">5.8</span> Log Analysis</a>
                        <a href="5-9-malware-analysis.html" class="nav-link"><span class="nav-link-number">5.9</span> Malware Analysis</a>
                    </div>
                </div>

                <!-- Section 6: Python Scripting -->
                <div class="nav-section" data-section="python">
                    <div class="nav-section-header">
                        <span class="nav-section-icon">üêç</span>
                        Python Scripting
                        <span class="nav-section-toggle">‚ñº</span>
                    </div>
                    <div class="nav-section-content">
                        <a href="6-1-python-security-intro.html" class="nav-link"><span class="nav-link-number">6.1</span> Python for Security</a>
                        <a href="6-2-python-fundamentals.html" class="nav-link"><span class="nav-link-number">6.2</span> Python Fundamentals</a>
                        <a href="6-3-python-functions.html" class="nav-link"><span class="nav-link-number">6.3</span> Functions & Modules</a>
                        <a href="6-4-python-file-handling.html" class="nav-link"><span class="nav-link-number">6.4</span> File & Data Handling</a>
                        <a href="6-5-python-networking.html" class="nav-link"><span class="nav-link-number">6.5</span> Python Networking</a>
                        <a href="6-6-python-security-automation.html" class="nav-link"><span class="nav-link-number">6.6</span> Security Automation</a>
                        <a href="6-7-python-forensics.html" class="nav-link"><span class="nav-link-number">6.7</span> Forensics & Log Analysis</a>
                        <a href="6-8-python-apis.html" class="nav-link"><span class="nav-link-number">6.8</span> Python & APIs</a>
                    </div>
                </div>

                <!-- Section 7: Cloud Automation -->
                <div class="nav-section collapsed" data-section="cloud">
                    <div class="nav-section-header">
                        <span class="nav-section-icon">‚òÅÔ∏è</span>
                        Cloud Automation
                        <span class="nav-section-toggle">‚ñº</span>
                    </div>
                    <div class="nav-section-content">
                        <a href="7-1-azure-automation.html" class="nav-link"><span class="nav-link-number">7.1</span> Azure Automation</a>
                    </div>
                </div>

                <!-- Section 8: Real-World Projects -->
                <div class="nav-section collapsed" data-section="projects">
                    <div class="nav-section-header">
                        <span class="nav-section-icon">üöÄ</span>
                        Real-World Projects
                        <span class="nav-section-toggle">‚ñº</span>
                    </div>
                    <div class="nav-section-content">
                        <a href="8-1-security-dashboard.html" class="nav-link"><span class="nav-link-number">8.1</span> Security Dashboard</a>
                        <a href="8-2-log-aggregator.html" class="nav-link"><span class="nav-link-number">8.2</span> Log Aggregator</a>
                        <a href="8-3-asset-inventory.html" class="nav-link"><span class="nav-link-number">8.3</span> Asset Inventory</a>
                    </div>
                </div>

                <!-- Section 9: Troubleshooting -->
                <div class="nav-section collapsed" data-section="troubleshooting">
                    <div class="nav-section-header">
                        <span class="nav-section-icon">üîß</span>
                        Troubleshooting
                        <span class="nav-section-toggle">‚ñº</span>
                    </div>
                    <div class="nav-section-content">
                        <a href="9-1-common-errors.html" class="nav-link"><span class="nav-link-number">9.1</span> Common Errors</a>
                        <a href="9-2-debugging-techniques.html" class="nav-link"><span class="nav-link-number">9.2</span> Debugging Techniques</a>
                        <a href="9-3-performance-issues.html" class="nav-link"><span class="nav-link-number">9.3</span> Performance Issues</a>
                    </div>
                </div>

                <!-- Section 10: Reference -->
                <div class="nav-section collapsed" data-section="reference">
                    <div class="nav-section-header">
                        <span class="nav-section-icon">üìñ</span>
                        Reference
                        <span class="nav-section-toggle">‚ñº</span>
                    </div>
                    <div class="nav-section-content">
                        <a href="10-1-cheat-sheets.html" class="nav-link"><span class="nav-link-number">10.1</span> Cheat Sheets</a>
                        <a href="10-2-interview-preparation.html" class="nav-link"><span class="nav-link-number">10.2</span> Interview Preparation</a>
                        <a href="10-3-log-paths-reference.html" class="nav-link"><span class="nav-link-number">10.3</span> Log Paths Reference</a>
                    </div>
                </div>
            </nav>
        </aside>

        </aside>

        <main class="main-content">
            <div class="content-wrapper">
                <nav class="breadcrumb">
                    <a href="index.html">Home</a>
                    <span class="breadcrumb-separator">‚Ä∫</span>
                    <a href="4-1-batch-intro.html">Batch Scripting</a>
                    <span class="breadcrumb-separator">‚Ä∫</span>
                    <span>Control Flow</span>
                </nav>

                <h1>4.3 Batch Control Flow</h1>

                <div class="info-box overview-box">
                    <div class="info-box-header">
                        <div class="info-box-icon">üìñ</div>
                        <div class="info-box-title">What You'll Learn</div>
                    </div>
                    <ul>
                        <li>IF statements and comparisons</li>
                        <li>FOR loops (files, directories, ranges, tokens)</li>
                        <li>GOTO and labels</li>
                        <li>CALL for subroutines</li>
                        <li>Error handling patterns</li>
                    </ul>
                </div>

                <h2>IF Statements</h2>
                <div class="code-container">
                    <div class="code-header">
                        <span>Batch - Basic IF Syntax</span>
                        <button class="copy-btn" onclick="copyCode(this)">üìã Copy</button>
                    </div>
                    <pre><code>@echo off

REM Basic IF
IF "%1"=="" echo No parameter provided

REM IF-ELSE (use parentheses)
IF "%1"=="start" (
    echo Starting service...
) ELSE (
    echo Unknown command
)

REM IF-ELSE IF-ELSE
IF "%1"=="start" (
    echo Starting...
) ELSE IF "%1"=="stop" (
    echo Stopping...
) ELSE IF "%1"=="status" (
    echo Checking status...
) ELSE (
    echo Usage: %0 start^|stop^|status
)

REM Case-insensitive comparison with /I
IF /I "%1"=="YES" echo You said yes
IF /I "%choice%"=="y" echo Confirmed</code></pre>
                </div>

                <h3>Comparison Operators</h3>
                <div class="code-container">
                    <div class="code-header">
                        <span>Batch - Comparisons</span>
                        <button class="copy-btn" onclick="copyCode(this)">üìã Copy</button>
                    </div>
                    <pre><code>@echo off

SET /A num=10

REM String comparison (use quotes for safety)
IF "%var%"=="value" echo Equal
IF NOT "%var%"=="value" echo Not equal

REM Numeric comparisons
IF %num% EQU 10 echo Equal to 10
IF %num% NEQ 5 echo Not equal to 5
IF %num% LSS 20 echo Less than 20
IF %num% LEQ 10 echo Less or equal to 10
IF %num% GTR 5 echo Greater than 5
IF %num% GEQ 10 echo Greater or equal to 10

REM Check if variable is defined
IF DEFINED var echo Variable exists
IF NOT DEFINED var echo Variable not set

REM Check ERRORLEVEL
ping -n 1 192.168.1.1 >nul 2>&1
IF %ERRORLEVEL% EQU 0 (
    echo Host is up
) ELSE (
    echo Host is down
)

REM Shorthand errorlevel check
IF ERRORLEVEL 1 echo Command failed</code></pre>
                </div>

                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Operator</th>
                                <th>Meaning</th>
                                <th>Example</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr><td><code>EQU</code></td><td>Equal</td><td><code>IF %a% EQU 5</code></td></tr>
                            <tr><td><code>NEQ</code></td><td>Not equal</td><td><code>IF %a% NEQ 0</code></td></tr>
                            <tr><td><code>LSS</code></td><td>Less than</td><td><code>IF %a% LSS 10</code></td></tr>
                            <tr><td><code>LEQ</code></td><td>Less or equal</td><td><code>IF %a% LEQ 10</code></td></tr>
                            <tr><td><code>GTR</code></td><td>Greater than</td><td><code>IF %a% GTR 0</code></td></tr>
                            <tr><td><code>GEQ</code></td><td>Greater or equal</td><td><code>IF %a% GEQ 1</code></td></tr>
                        </tbody>
                    </table>
                </div>

                <h3>File and Directory Tests</h3>
                <div class="code-container">
                    <div class="code-header">
                        <span>Batch - File/Directory Checks</span>
                        <button class="copy-btn" onclick="copyCode(this)">üìã Copy</button>
                    </div>
                    <pre><code>@echo off

REM Check if file exists
IF EXIST "C:\Windows\System32\cmd.exe" (
    echo File exists
)

REM Check if file does NOT exist
IF NOT EXIST "C:\temp\log.txt" (
    echo Creating log file...
    echo Log started > "C:\temp\log.txt"
)

REM Check if directory exists (use trailing backslash or NUL)
IF EXIST "C:\Logs\" echo Directory exists
IF EXIST "C:\Logs\NUL" echo Directory exists (alt method)

REM Wildcard check
IF EXIST "*.txt" echo Text files found
IF EXIST "C:\Logs\*.log" echo Log files present

REM Common security check pattern
SET suspicious=C:\Users\Public\malware.exe
IF EXIST "%suspicious%" (
    echo [ALERT] Suspicious file found: %suspicious%
    echo Found at %DATE% %TIME% >> alerts.log
)</code></pre>
                </div>

                <h2>FOR Loops</h2>
                <h3>Loop Through Files</h3>
                <div class="code-container">
                    <div class="code-header">
                        <span>Batch - FOR with Files</span>
                        <button class="copy-btn" onclick="copyCode(this)">üìã Copy</button>
                    </div>
                    <pre><code>@echo off

REM Loop through files in current directory
REM Note: Use %%i in scripts, %i on command line
FOR %%f IN (*.txt) DO (
    echo Processing: %%f
)

REM Loop through files in specific directory
FOR %%f IN (C:\Logs\*.log) DO (
    echo Log file: %%f
    type "%%f" | find "ERROR"
)

REM Multiple patterns
FOR %%f IN (*.txt *.log *.csv) DO (
    echo Found: %%f
)

REM Recursive with /R (all subdirectories)
FOR /R "C:\Users" %%f IN (*.exe) DO (
    echo Executable: %%f
)</code></pre>
                </div>

                <h3>Loop Through Directories</h3>
                <div class="code-container">
                    <div class="code-header">
                        <span>Batch - FOR /D with Directories</span>
                        <button class="copy-btn" onclick="copyCode(this)">üìã Copy</button>
                    </div>
                    <pre><code>@echo off

REM Loop through directories only
FOR /D %%d IN (C:\Users\*) DO (
    echo User folder: %%d
)

REM Recursive directory listing
FOR /R /D "C:\Program Files" %%d IN (*) DO (
    echo Directory: %%d
)

REM Check each user's startup folder
FOR /D %%u IN (C:\Users\*) DO (
    IF EXIST "%%u\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup" (
        echo Checking startup for: %%u
        dir "%%u\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup"
    )
)</code></pre>
                </div>

                <h3>Loop with Numbers</h3>
                <div class="code-container">
                    <div class="code-header">
                        <span>Batch - FOR /L with Numbers</span>
                        <button class="copy-btn" onclick="copyCode(this)">üìã Copy</button>
                    </div>
                    <pre><code>@echo off

REM FOR /L (start, step, end)
REM Count 1 to 10
FOR /L %%i IN (1,1,10) DO (
    echo Number: %%i
)

REM Count by 2s
FOR /L %%i IN (0,2,10) DO echo %%i

REM Countdown
FOR /L %%i IN (10,-1,1) DO (
    echo %%i...
    ping -n 2 127.0.0.1 >nul
)
echo Liftoff!

REM Port scan example (basic)
FOR /L %%p IN (20,1,25) DO (
    echo Checking port %%p...
)</code></pre>
                </div>

                <h3>Parse Command Output</h3>
                <div class="code-container">
                    <div class="code-header">
                        <span>Batch - FOR /F Parsing</span>
                        <button class="copy-btn" onclick="copyCode(this)">üìã Copy</button>
                    </div>
                    <pre><code>@echo off
SETLOCAL EnableDelayedExpansion

REM Parse command output
FOR /F "tokens=*" %%a IN ('dir /b *.txt') DO (
    echo File: %%a
)

REM Parse with tokens (columns)
REM tokens=1,2,3 gets first 3 columns
FOR /F "tokens=1,2,3" %%a IN ('netstat -an') DO (
    echo Proto: %%a  Local: %%b  Foreign: %%c
)

REM Skip header lines
FOR /F "skip=4 tokens=1,2" %%a IN ('netstat -an') DO (
    echo %%a %%b
)

REM Custom delimiter
FOR /F "tokens=1,2 delims=:" %%a IN ('ipconfig ^| find "IPv4"') DO (
    echo IP Address: %%b
)

REM Parse file contents
FOR /F "tokens=*" %%line IN (servers.txt) DO (
    echo Pinging %%line...
    ping -n 1 %%line >nul
)

REM Get specific value from command
FOR /F "tokens=2 delims==" %%a IN ('wmic os get caption /value') DO (
    SET os_name=%%a
)
echo OS: %os_name%</code></pre>
                </div>

                <div class="info-box memory-box">
                    <div class="info-box-header">
                        <div class="info-box-icon">üß†</div>
                        <div class="info-box-title">FOR /F Options</div>
                    </div>
                    <p><code>tokens=1,2,3</code> - Which columns to grab<br>
                    <code>delims=,;</code> - What separates columns (default: space/tab)<br>
                    <code>skip=N</code> - Skip first N lines<br>
                    <code>usebackq</code> - Use backticks for commands, quotes for filenames</p>
                </div>

                <h2>GOTO and Labels</h2>
                <div class="code-container">
                    <div class="code-header">
                        <span>Batch - GOTO and Labels</span>
                        <button class="copy-btn" onclick="copyCode(this)">üìã Copy</button>
                    </div>
                    <pre><code>@echo off

REM Labels start with :
REM GOTO jumps to a label

IF "%1"=="" GOTO usage
IF "%1"=="scan" GOTO scan
IF "%1"=="report" GOTO report
GOTO usage

:scan
echo Running security scan...
REM scan commands here
GOTO end

:report
echo Generating report...
REM report commands here
GOTO end

:usage
echo Usage: %0 scan^|report
echo.
echo   scan   - Run security scan
echo   report - Generate report
GOTO end

:end
echo Done.
exit /b 0</code></pre>
                </div>

                <h2>CALL for Subroutines</h2>
                <div class="code-container">
                    <div class="code-header">
                        <span>Batch - Subroutines with CALL</span>
                        <button class="copy-btn" onclick="copyCode(this)">üìã Copy</button>
                    </div>
                    <pre><code>@echo off
SETLOCAL EnableDelayedExpansion

REM Main script
echo Starting security checks...

CALL :check_service "WinDefend" "Windows Defender"
CALL :check_service "wscsvc" "Security Center"
CALL :check_service "MpsSvc" "Windows Firewall"

echo All checks complete.
exit /b 0

REM ========== Subroutines ==========

:check_service
REM %1 = service name, %2 = display name
sc query %~1 | find "RUNNING" >nul
IF %ERRORLEVEL% EQU 0 (
    echo [OK] %~2 is running
) ELSE (
    echo [WARN] %~2 is NOT running!
)
exit /b 0

:log_message
REM %1 = message
echo [%DATE% %TIME%] %~1 >> security.log
exit /b 0</code></pre>
                </div>

                <h2>Error Handling</h2>
                <div class="code-container">
                    <div class="code-header">
                        <span>Batch - Error Handling Patterns</span>
                        <button class="copy-btn" onclick="copyCode(this)">üìã Copy</button>
                    </div>
                    <pre><code>@echo off
SETLOCAL

REM Pattern 1: Check after each command
ping -n 1 192.168.1.1 >nul 2>&1
IF %ERRORLEVEL% NEQ 0 (
    echo Failed to ping target
    exit /b 1
)

REM Pattern 2: Using || for error (like bash)
ping -n 1 badhost >nul 2>&1 || echo Ping failed

REM Pattern 3: Using && for success
ping -n 1 localhost >nul 2>&1 && echo Ping succeeded

REM Pattern 4: Combined
copy file.txt backup\ >nul 2>&1 && (
    echo Copy succeeded
) || (
    echo Copy failed
    exit /b 1
)

REM Pattern 5: Trap all errors
:main
CALL :do_work
IF %ERRORLEVEL% NEQ 0 GOTO error
echo Success!
exit /b 0

:error
echo An error occurred (code: %ERRORLEVEL%)
exit /b 1

:do_work
REM Commands that might fail
exit /b 0</code></pre>
                </div>

                <h2>Security Script Example</h2>
                <div class="code-container">
                    <div class="code-header">
                        <span>Batch - Persistence Check Script</span>
                        <button class="copy-btn" onclick="copyCode(this)">üìã Copy</button>
                    </div>
                    <pre><code>@echo off
SETLOCAL EnableDelayedExpansion

echo ==========================================
echo Persistence Location Checker
echo ==========================================
echo.

SET found=0

REM Check Run keys
echo [*] Checking Registry Run keys...
FOR %%k IN (
    "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Run"
    "HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\Run"
    "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\RunOnce"
) DO (
    echo.
    echo Checking %%k:
    reg query %%k 2>nul
)

REM Check Startup folders
echo.
echo [*] Checking Startup folders...
FOR /D %%u IN (C:\Users\*) DO (
    SET startup=%%u\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup
    IF EXIST "!startup!" (
        echo.
        echo User: %%~nu
        dir /b "!startup!" 2>nul
    )
)

REM Check scheduled tasks
echo.
echo [*] Checking Scheduled Tasks...
schtasks /query /fo LIST | find "TaskName"

echo.
echo ==========================================
echo Check complete
echo ==========================================

ENDLOCAL</code></pre>
                </div>

                <h2>Key Takeaways</h2>
                <ul>
                    <li><code>IF</code> uses <code>EQU, NEQ, LSS, LEQ, GTR, GEQ</code> for numbers</li>
                    <li><code>IF EXIST</code> checks files/directories, <code>IF DEFINED</code> checks variables</li>
                    <li><code>FOR %%i IN (...)</code> - files, <code>FOR /D</code> - directories, <code>FOR /L</code> - numbers</li>
                    <li><code>FOR /F</code> parses text with tokens and delimiters</li>
                    <li>Use <code>%%</code> in scripts, <code>%</code> on command line for FOR variables</li>
                    <li><code>CALL :label</code> for subroutines, <code>exit /b</code> to return</li>
                </ul>

                                <div class="page-navigation">
                    <a href="4-2-batch-variables.html" class="nav-button prev">
                        <span class="nav-button-label">Previous</span>
                        <span class="nav-button-title">‚Üê 4.2 Variables & Parameters</span>
                    </a>
                    <a href="4-4-batch-file-operations.html" class="nav-button next">
                        <span class="nav-button-label">Next</span>
                        <span class="nav-button-title">4.4 File Operations ‚Üí</span>
                    </a>
                </div>
            </div>
        </main>
    </div>

    <div class="search-modal" id="searchModal">
        <div class="search-modal-content">
            <input type="text" class="search-modal-input" id="searchModalInput" placeholder="Search documentation..." autocomplete="off">
            <div class="search-modal-results" id="searchResults"></div>
        </div>
    </div>

    <button class="mobile-toggle">‚ò∞</button>
    <script src="main.js"></script>
</body>
</html>
