<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2.9 WMI and CIM - PowerShell & Scripting Guide</title>
    <link rel="stylesheet" href="main.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
</head>
<body>
    <div class="layout-wrapper">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo">
                    <div class="sidebar-logo-icon">ğŸ–¥ï¸</div>
                    <div class="sidebar-logo-text">
                        PowerShell & Scripting
                        <span>Ultimate Guide</span>
                    </div>
                </div>
                <div class="search-container">
                    <span class="search-icon">ğŸ”</span>
                    <input type="text" class="search-input" placeholder="Search documentation...">
                    <span class="search-shortcut">Ctrl+K</span>
                </div>
            </div>
            
                        <nav class="sidebar-nav">
                <!-- Section 1: Scripting Fundamentals -->
                <div class="nav-section" data-section="fundamentals">
                    <div class="nav-section-header">
                        <span class="nav-section-icon">ğŸ“š</span>
                        Scripting Fundamentals
                        <span class="nav-section-toggle">â–¼</span>
                    </div>
                    <div class="nav-section-content">
                        <a href="1-1-scripting-overview.html" class="nav-link"><span class="nav-link-number">1.1</span> Scripting Overview</a>
                        <a href="1-2-choosing-right-tool.html" class="nav-link"><span class="nav-link-number">1.2</span> Choosing the Right Tool</a>
                        <a href="1-3-setting-up-environment.html" class="nav-link"><span class="nav-link-number">1.3</span> Setting Up Environment</a>
                    </div>
                </div>

                <!-- Section 2: PowerShell Deep Dive -->
                <div class="nav-section" data-section="powershell">
                    <div class="nav-section-header">
                        <span class="nav-section-icon">ğŸ”·</span>
                        PowerShell Deep Dive
                        <span class="nav-section-toggle">â–¼</span>
                    </div>
                    <div class="nav-section-content">
                        <a href="2-1-powershell-intro.html" class="nav-link"><span class="nav-link-number">2.1</span> PowerShell Introduction</a>
                        <a href="2-2-cmdlet-anatomy.html" class="nav-link"><span class="nav-link-number">2.2</span> Cmdlet Anatomy</a>
                        <a href="2-3-pipeline-mastery.html" class="nav-link"><span class="nav-link-number">2.3</span> Pipeline Mastery</a>
                        <a href="2-4-variables-data-types.html" class="nav-link"><span class="nav-link-number">2.4</span> Variables & Data Types</a>
                        <a href="2-5-working-with-objects.html" class="nav-link"><span class="nav-link-number">2.5</span> Working with Objects</a>
                        <a href="2-6-control-structures.html" class="nav-link"><span class="nav-link-number">2.6</span> Control Structures</a>
                        <a href="2-7-functions.html" class="nav-link"><span class="nav-link-number">2.7</span> Functions</a>
                        <a href="2-8-files.html" class="nav-link"><span class="nav-link-number">2.8</span> Working with Files</a>
                        <a href="2-9-wmi-cim.html" class="nav-link"><span class="nav-link-number">2.9</span> WMI & CIM</a>
                        <a href="2-10-registry.html" class="nav-link"><span class="nav-link-number">2.10</span> Registry Operations</a>
                        <a href="2-11-eventlog-analysis.html" class="nav-link"><span class="nav-link-number">2.11</span> Event Log Analysis</a>
                        <a href="2-12-active-directory.html" class="nav-link"><span class="nav-link-number">2.12</span> Active Directory</a>
                        <a href="2-13-networking-commands.html" class="nav-link"><span class="nav-link-number">2.13</span> Networking Commands</a>
                        <a href="2-14-web-requests.html" class="nav-link"><span class="nav-link-number">2.14</span> Web Requests & APIs</a>
                        <a href="2-15-remoting-jobs.html" class="nav-link"><span class="nav-link-number">2.15</span> Remoting & Jobs</a>
                        <a href="2-16-error-handling.html" class="nav-link"><span class="nav-link-number">2.16</span> Error Handling</a>
                        <a href="2-17-modules-profiles.html" class="nav-link"><span class="nav-link-number">2.17</span> Modules & Profiles</a>
                    </div>
                </div>

                <!-- Section 3: Bash Scripting -->
                <div class="nav-section" data-section="bash">
                    <div class="nav-section-header">
                        <span class="nav-section-icon">ğŸ§</span>
                        Bash Scripting
                        <span class="nav-section-toggle">â–¼</span>
                    </div>
                    <div class="nav-section-content">
                        <a href="3-1-bash-intro.html" class="nav-link"><span class="nav-link-number">3.1</span> Bash Introduction</a>
                        <a href="3-2-bash-variables.html" class="nav-link"><span class="nav-link-number">3.2</span> Variables & Data Types</a>
                        <a href="3-3-control-structures.html" class="nav-link"><span class="nav-link-number">3.3</span> Control Structures</a>
                        <a href="3-4-bash-functions.html" class="nav-link"><span class="nav-link-number">3.4</span> Functions & Scripts</a>
                        <a href="3-5-file-io.html" class="nav-link"><span class="nav-link-number">3.5</span> File I/O</a>
                        <a href="3-6-process-management.html" class="nav-link"><span class="nav-link-number">3.6</span> Process Management</a>
                        <a href="3-7-system-admin.html" class="nav-link"><span class="nav-link-number">3.7</span> System Administration</a>
                        <a href="3-8-regex.html" class="nav-link"><span class="nav-link-number">3.8</span> Regular Expressions</a>
                        <a href="3-9-text-processing.html" class="nav-link"><span class="nav-link-number">3.9</span> Text Processing</a>
                        <a href="3-10-bash-networking.html" class="nav-link"><span class="nav-link-number">3.10</span> Bash Networking</a>
                    </div>
                </div>

                <!-- Section 4: Batch/CMD Scripting -->
                <div class="nav-section" data-section="batch">
                    <div class="nav-section-header">
                        <span class="nav-section-icon">ğŸ“¦</span>
                        Batch/CMD Scripting
                        <span class="nav-section-toggle">â–¼</span>
                    </div>
                    <div class="nav-section-content">
                        <a href="4-1-batch-intro.html" class="nav-link"><span class="nav-link-number">4.1</span> Batch Introduction</a>
                        <a href="4-2-batch-variables.html" class="nav-link"><span class="nav-link-number">4.2</span> Variables & Parameters</a>
                        <a href="4-3-batch-control-flow.html" class="nav-link"><span class="nav-link-number">4.3</span> Control Flow</a>
                        <a href="4-4-batch-file-operations.html" class="nav-link"><span class="nav-link-number">4.4</span> File Operations</a>
                    </div>
                </div>

                <!-- Section 5: Security Automation -->
                <div class="nav-section" data-section="security">
                    <div class="nav-section-header">
                        <span class="nav-section-icon">ğŸ›¡ï¸</span>
                        Security Automation
                        <span class="nav-section-toggle">â–¼</span>
                    </div>
                    <div class="nav-section-content">
                        <a href="5-1-incident-response.html" class="nav-link"><span class="nav-link-number">5.1</span> Incident Response</a>
                        <a href="5-2-threat-hunting.html" class="nav-link"><span class="nav-link-number">5.2</span> Threat Hunting</a>
                        <a href="5-3-vulnerability-scanning.html" class="nav-link"><span class="nav-link-number">5.3</span> Vulnerability Scanning</a>
                        <a href="5-4-forensics-scripts.html" class="nav-link"><span class="nav-link-number">5.4</span> Forensics Scripts</a>
                        <a href="5-5-siem-integration.html" class="nav-link"><span class="nav-link-number">5.5</span> SIEM Integration</a>
                        <a href="5-6-edr-automation.html" class="nav-link"><span class="nav-link-number">5.6</span> EDR Automation</a>
                        <a href="5-7-compliance-automation.html" class="nav-link"><span class="nav-link-number">5.7</span> Compliance Automation</a>
                        <a href="5-8-log-analysis.html" class="nav-link"><span class="nav-link-number">5.8</span> Log Analysis</a>
                        <a href="5-9-malware-analysis.html" class="nav-link"><span class="nav-link-number">5.9</span> Malware Analysis</a>
                    </div>
                </div>

                <!-- Section 6: Python Scripting -->
                <div class="nav-section" data-section="python">
                    <div class="nav-section-header">
                        <span class="nav-section-icon">ğŸ</span>
                        Python Scripting
                        <span class="nav-section-toggle">â–¼</span>
                    </div>
                    <div class="nav-section-content">
                        <a href="6-1-python-security-intro.html" class="nav-link"><span class="nav-link-number">6.1</span> Python for Security</a>
                        <a href="6-2-python-fundamentals.html" class="nav-link"><span class="nav-link-number">6.2</span> Python Fundamentals</a>
                        <a href="6-3-python-functions.html" class="nav-link"><span class="nav-link-number">6.3</span> Functions & Modules</a>
                        <a href="6-4-python-file-handling.html" class="nav-link"><span class="nav-link-number">6.4</span> File & Data Handling</a>
                        <a href="6-5-python-networking.html" class="nav-link"><span class="nav-link-number">6.5</span> Python Networking</a>
                        <a href="6-6-python-security-automation.html" class="nav-link"><span class="nav-link-number">6.6</span> Security Automation</a>
                        <a href="6-7-python-forensics.html" class="nav-link"><span class="nav-link-number">6.7</span> Forensics & Log Analysis</a>
                        <a href="6-8-python-apis.html" class="nav-link"><span class="nav-link-number">6.8</span> Python & APIs</a>
                    </div>
                </div>

                <!-- Section 7: Cloud Automation -->
                <div class="nav-section collapsed" data-section="cloud">
                    <div class="nav-section-header">
                        <span class="nav-section-icon">â˜ï¸</span>
                        Cloud Automation
                        <span class="nav-section-toggle">â–¼</span>
                    </div>
                    <div class="nav-section-content">
                        <a href="7-1-azure-automation.html" class="nav-link"><span class="nav-link-number">7.1</span> Azure Automation</a>
                    </div>
                </div>

                <!-- Section 8: Real-World Projects -->
                <div class="nav-section collapsed" data-section="projects">
                    <div class="nav-section-header">
                        <span class="nav-section-icon">ğŸš€</span>
                        Real-World Projects
                        <span class="nav-section-toggle">â–¼</span>
                    </div>
                    <div class="nav-section-content">
                        <a href="8-1-security-dashboard.html" class="nav-link"><span class="nav-link-number">8.1</span> Security Dashboard</a>
                        <a href="8-2-log-aggregator.html" class="nav-link"><span class="nav-link-number">8.2</span> Log Aggregator</a>
                        <a href="8-3-asset-inventory.html" class="nav-link"><span class="nav-link-number">8.3</span> Asset Inventory</a>
                    </div>
                </div>

                <!-- Section 9: Troubleshooting -->
                <div class="nav-section collapsed" data-section="troubleshooting">
                    <div class="nav-section-header">
                        <span class="nav-section-icon">ğŸ”§</span>
                        Troubleshooting
                        <span class="nav-section-toggle">â–¼</span>
                    </div>
                    <div class="nav-section-content">
                        <a href="9-1-common-errors.html" class="nav-link"><span class="nav-link-number">9.1</span> Common Errors</a>
                        <a href="9-2-debugging-techniques.html" class="nav-link"><span class="nav-link-number">9.2</span> Debugging Techniques</a>
                        <a href="9-3-performance-issues.html" class="nav-link"><span class="nav-link-number">9.3</span> Performance Issues</a>
                    </div>
                </div>

                <!-- Section 10: Reference -->
                <div class="nav-section collapsed" data-section="reference">
                    <div class="nav-section-header">
                        <span class="nav-section-icon">ğŸ“–</span>
                        Reference
                        <span class="nav-section-toggle">â–¼</span>
                    </div>
                    <div class="nav-section-content">
                        <a href="10-1-cheat-sheets.html" class="nav-link"><span class="nav-link-number">10.1</span> Cheat Sheets</a>
                        <a href="10-2-interview-preparation.html" class="nav-link"><span class="nav-link-number">10.2</span> Interview Preparation</a>
                        <a href="10-3-log-paths-reference.html" class="nav-link"><span class="nav-link-number">10.3</span> Log Paths Reference</a>
                    </div>
                </div>
            </nav>
        </aside>





        <!-- Main Content Area -->
        <main class="main-content">
            <div class="content-wrapper">
                <!-- Breadcrumb -->
                <nav class="breadcrumb">
                    <a href="index.html">Home</a>
                    <span class="breadcrumb-separator">â€º</span>
                    <a href="index.html#powershell">PowerShell Deep Dive</a>
                    <span class="breadcrumb-separator">â€º</span>
                    <span>WMI and CIM</span>
                </nav>

                <!-- Page Title -->
                <h1>2.9 WMI and CIM</h1>

                <!-- What You'll Learn Box -->
                <div class="info-box overview-box">
                    <div class="info-box-header">
                        <div class="info-box-icon">ğŸ“–</div>
                        <div class="info-box-title">What You'll Learn</div>
                    </div>
                    <ul>
                        <li>Understand WMI vs CIM and when to use each</li>
                        <li>Query system information with Get-CimInstance</li>
                        <li>Use WQL queries for advanced filtering</li>
                        <li>Retrieve security-relevant system data</li>
                    </ul>
                </div>

                <!-- WMI vs CIM -->
                <div class="ascii-diagram">
                    <div class="ascii-diagram-title">ğŸ“Š WMI vs CIM Cmdlets</div>
<pre>
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    WMI vs CIM - WHICH TO USE?                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   WMI (Legacy)              â”‚    â”‚   CIM (Modern) âœ“            â”‚
    â”‚   Get-WmiObject             â”‚    â”‚   Get-CimInstance           â”‚
    â”‚                             â”‚    â”‚                             â”‚
    â”‚ â€¢ Uses DCOM (RPC)           â”‚    â”‚ â€¢ Uses WS-Man (WinRM)       â”‚
    â”‚ â€¢ Firewall unfriendly       â”‚    â”‚ â€¢ Firewall friendly         â”‚
    â”‚ â€¢ Windows only              â”‚    â”‚ â€¢ Cross-platform (PS 7+)    â”‚
    â”‚ â€¢ Deprecated                â”‚    â”‚ â€¢ Recommended               â”‚
    â”‚ â€¢ PS 5.1 compatible         â”‚    â”‚ â€¢ Modern sessions           â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚                                  â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   SAME DATA SOURCE    â”‚
                    â”‚   (WMI Repository)    â”‚
                    â”‚   Win32_*, CIM_*      â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    Rule: Always use Get-CimInstance unless you need PS 2.0 compatibility
</pre>
                </div>

                <!-- Memory Aid -->
                <div class="info-box memory-box">
                    <div class="info-box-header">
                        <div class="info-box-icon">ğŸ§ </div>
                        <div class="info-box-title">Memory Aid: Common WMI Classes</div>
                    </div>
                    <ul>
                        <li><strong>Win32_OperatingSystem</strong> â†’ OS info, uptime, memory</li>
                        <li><strong>Win32_ComputerSystem</strong> â†’ Computer name, domain, model</li>
                        <li><strong>Win32_Process</strong> â†’ Running processes, command lines</li>
                        <li><strong>Win32_Service</strong> â†’ Services, paths, accounts</li>
                        <li><strong>Win32_LogicalDisk</strong> â†’ Disk space, drive letters</li>
                        <li><strong>Win32_NetworkAdapterConfiguration</strong> â†’ IP, MAC, DNS</li>
                        <li><strong>Win32_UserAccount</strong> â†’ Local user accounts</li>
                        <li><strong>Win32_StartupCommand</strong> â†’ Startup programs</li>
                    </ul>
                </div>

                <!-- Basic CIM Queries -->
                <h2>Basic CIM Queries</h2>

                <div class="code-container">
                    <div class="code-header">
                        <span class="code-language powershell">
                            <span class="code-language-icon">ğŸ”·</span>
                            PowerShell - Get-CimInstance Basics
                        </span>
                        <button class="code-copy-btn"><span>ğŸ“‹</span> Copy</button>
                    </div>
                    <div class="code-block">
<pre><code><span class="token-comment"># Operating System information</span>
<span class="token-cmdlet">Get-CimInstance</span> Win32_OperatingSystem | <span class="token-cmdlet">Select-Object</span> Caption, Version, 
    BuildNumber, LastBootUpTime, FreePhysicalMemory

<span class="token-comment"># Computer system info</span>
<span class="token-cmdlet">Get-CimInstance</span> Win32_ComputerSystem | <span class="token-cmdlet">Select-Object</span> Name, Domain, 
    Manufacturer, Model, TotalPhysicalMemory

<span class="token-comment"># BIOS information</span>
<span class="token-cmdlet">Get-CimInstance</span> Win32_BIOS | <span class="token-cmdlet">Select-Object</span> Manufacturer, SMBIOSBIOSVersion, 
    SerialNumber, ReleaseDate

<span class="token-comment"># Processor info</span>
<span class="token-cmdlet">Get-CimInstance</span> Win32_Processor | <span class="token-cmdlet">Select-Object</span> Name, NumberOfCores, 
    NumberOfLogicalProcessors, MaxClockSpeed

<span class="token-comment"># Disk information</span>
<span class="token-cmdlet">Get-CimInstance</span> Win32_LogicalDisk | <span class="token-cmdlet">Where-Object</span> DriveType <span class="token-operator">-eq</span> <span class="token-number">3</span> |
    <span class="token-cmdlet">Select-Object</span> DeviceID, 
        @{N=<span class="token-string">'SizeGB'</span>;E={[math]::Round(<span class="token-variable">$_</span>.Size / <span class="token-number">1GB</span>, <span class="token-number">2</span>)}},
        @{N=<span class="token-string">'FreeGB'</span>;E={[math]::Round(<span class="token-variable">$_</span>.FreeSpace / <span class="token-number">1GB</span>, <span class="token-number">2</span>)}},
        @{N=<span class="token-string">'UsedPercent'</span>;E={[math]::Round(((<span class="token-variable">$_</span>.Size - <span class="token-variable">$_</span>.FreeSpace) / <span class="token-variable">$_</span>.Size) * <span class="token-number">100</span>, <span class="token-number">1</span>)}}

<span class="token-comment"># Network adapter configuration</span>
<span class="token-cmdlet">Get-CimInstance</span> Win32_NetworkAdapterConfiguration | 
    <span class="token-cmdlet">Where-Object</span> IPEnabled | 
    <span class="token-cmdlet">Select-Object</span> Description, IPAddress, MACAddress, DefaultIPGateway, DNSServerSearchOrder

<span class="token-comment"># List all available classes</span>
<span class="token-cmdlet">Get-CimClass</span> <span class="token-parameter">-Namespace</span> root/cimv2 | <span class="token-cmdlet">Where-Object</span> CimClassName <span class="token-operator">-like</span> <span class="token-string">'Win32_*'</span>

<span class="token-comment"># Explore class properties</span>
<span class="token-cmdlet">Get-CimClass</span> Win32_Process | <span class="token-cmdlet">Select-Object</span> <span class="token-parameter">-ExpandProperty</span> CimClassProperties | 
    <span class="token-cmdlet">Select-Object</span> Name, CimType</code></pre>
                    </div>
                </div>

                <!-- Process Information -->
                <h2>Process Information</h2>

                <div class="code-container">
                    <div class="code-header">
                        <span class="code-language powershell">
                            <span class="code-language-icon">ğŸ”·</span>
                            PowerShell - Process Queries
                        </span>
                        <button class="code-copy-btn"><span>ğŸ“‹</span> Copy</button>
                    </div>
                    <div class="code-block">
<pre><code><span class="token-comment"># All processes with command lines (security gold!)</span>
<span class="token-cmdlet">Get-CimInstance</span> Win32_Process | 
    <span class="token-cmdlet">Select-Object</span> Name, ProcessId, ParentProcessId, CommandLine, 
        CreationDate, ExecutablePath |
    <span class="token-cmdlet">Format-Table</span> <span class="token-parameter">-AutoSize</span>

<span class="token-comment"># Find process owner</span>
<span class="token-cmdlet">Get-CimInstance</span> Win32_Process | <span class="token-cmdlet">ForEach-Object</span> {
    <span class="token-variable">$Owner</span> = <span class="token-cmdlet">Invoke-CimMethod</span> <span class="token-parameter">-InputObject</span> <span class="token-variable">$_</span> <span class="token-parameter">-MethodName</span> GetOwner
    [PSCustomObject]@{
        Name = <span class="token-variable">$_</span>.Name
        PID = <span class="token-variable">$_</span>.ProcessId
        Owner = <span class="token-string">"$($Owner.Domain)\$($Owner.User)"</span>
        CommandLine = <span class="token-variable">$_</span>.CommandLine
    }
} | <span class="token-cmdlet">Where-Object</span> Owner <span class="token-operator">-notlike</span> <span class="token-string">'*\SYSTEM'</span>

<span class="token-comment"># Processes with network connections (WQL filter)</span>
<span class="token-cmdlet">Get-CimInstance</span> <span class="token-parameter">-Query</span> <span class="token-string">"SELECT * FROM Win32_Process WHERE Name = 'powershell.exe'"</span>

<span class="token-comment"># Find PowerShell processes with encoded commands</span>
<span class="token-cmdlet">Get-CimInstance</span> Win32_Process | 
    <span class="token-cmdlet">Where-Object</span> { <span class="token-variable">$_</span>.CommandLine <span class="token-operator">-match</span> <span class="token-string">'-[Ee]nc|-[Ee]ncodedCommand'</span> } |
    <span class="token-cmdlet">Select-Object</span> Name, ProcessId, CommandLine

<span class="token-comment"># Processes running from suspicious locations</span>
<span class="token-cmdlet">Get-CimInstance</span> Win32_Process | 
    <span class="token-cmdlet">Where-Object</span> { 
        <span class="token-variable">$_</span>.ExecutablePath <span class="token-operator">-like</span> <span class="token-string">'*\Temp\*'</span> <span class="token-operator">-or</span>
        <span class="token-variable">$_</span>.ExecutablePath <span class="token-operator">-like</span> <span class="token-string">'*\AppData\*'</span> <span class="token-operator">-or</span>
        <span class="token-variable">$_</span>.ExecutablePath <span class="token-operator">-like</span> <span class="token-string">'*\Downloads\*'</span>
    } | <span class="token-cmdlet">Select-Object</span> Name, ProcessId, ExecutablePath</code></pre>
                    </div>
                </div>

                <!-- Service Information -->
                <h2>Service Information</h2>

                <div class="code-container">
                    <div class="code-header">
                        <span class="code-language powershell">
                            <span class="code-language-icon">ğŸ”·</span>
                            PowerShell - Service Queries
                        </span>
                        <button class="code-copy-btn"><span>ğŸ“‹</span> Copy</button>
                    </div>
                    <div class="code-block">
<pre><code><span class="token-comment"># All services with details (more info than Get-Service)</span>
<span class="token-cmdlet">Get-CimInstance</span> Win32_Service | <span class="token-cmdlet">Select-Object</span> Name, DisplayName, State, 
    StartMode, StartName, PathName, ProcessId | <span class="token-cmdlet">Format-Table</span> <span class="token-parameter">-AutoSize</span>

<span class="token-comment"># Running services</span>
<span class="token-cmdlet">Get-CimInstance</span> <span class="token-parameter">-Query</span> <span class="token-string">"SELECT * FROM Win32_Service WHERE State = 'Running'"</span>

<span class="token-comment"># Services running as LocalSystem (potential privilege escalation)</span>
<span class="token-cmdlet">Get-CimInstance</span> Win32_Service | 
    <span class="token-cmdlet">Where-Object</span> { <span class="token-variable">$_</span>.StartName <span class="token-operator">-eq</span> <span class="token-string">'LocalSystem'</span> <span class="token-operator">-and</span> <span class="token-variable">$_</span>.State <span class="token-operator">-eq</span> <span class="token-string">'Running'</span> } |
    <span class="token-cmdlet">Select-Object</span> Name, PathName, ProcessId

<span class="token-comment"># Services with unquoted paths (vulnerability check)</span>
<span class="token-cmdlet">Get-CimInstance</span> Win32_Service | 
    <span class="token-cmdlet">Where-Object</span> { 
        <span class="token-variable">$_</span>.PathName <span class="token-operator">-and</span> 
        <span class="token-variable">$_</span>.PathName <span class="token-operator">-notmatch</span> <span class="token-string">'^"'</span> <span class="token-operator">-and</span> 
        <span class="token-variable">$_</span>.PathName <span class="token-operator">-match</span> <span class="token-string">'\s'</span> 
    } | <span class="token-cmdlet">Select-Object</span> Name, PathName

<span class="token-comment"># Services with non-standard paths</span>
<span class="token-cmdlet">Get-CimInstance</span> Win32_Service | 
    <span class="token-cmdlet">Where-Object</span> { 
        <span class="token-variable">$_</span>.PathName <span class="token-operator">-and</span> 
        <span class="token-variable">$_</span>.PathName <span class="token-operator">-notlike</span> <span class="token-string">'*\Windows\*'</span> <span class="token-operator">-and</span>
        <span class="token-variable">$_</span>.PathName <span class="token-operator">-notlike</span> <span class="token-string">'*\Program Files*'</span>
    } | <span class="token-cmdlet">Select-Object</span> Name, StartName, PathName

<span class="token-comment"># Start/Stop service using CIM methods</span>
<span class="token-variable">$Service</span> = <span class="token-cmdlet">Get-CimInstance</span> Win32_Service <span class="token-parameter">-Filter</span> <span class="token-string">"Name='Spooler'"</span>
<span class="token-cmdlet">Invoke-CimMethod</span> <span class="token-parameter">-InputObject</span> <span class="token-variable">$Service</span> <span class="token-parameter">-MethodName</span> StopService
<span class="token-cmdlet">Invoke-CimMethod</span> <span class="token-parameter">-InputObject</span> <span class="token-variable">$Service</span> <span class="token-parameter">-MethodName</span> StartService</code></pre>
                    </div>
                </div>

                <!-- User and Security -->
                <h2>User and Security Information</h2>

                <div class="code-container">
                    <div class="code-header">
                        <span class="code-language powershell">
                            <span class="code-language-icon">ğŸ”·</span>
                            PowerShell - Security Queries
                        </span>
                        <button class="code-copy-btn"><span>ğŸ“‹</span> Copy</button>
                    </div>
                    <div class="code-block">
<pre><code><span class="token-comment"># Local user accounts</span>
<span class="token-cmdlet">Get-CimInstance</span> Win32_UserAccount <span class="token-parameter">-Filter</span> <span class="token-string">"LocalAccount=True"</span> |
    <span class="token-cmdlet">Select-Object</span> Name, FullName, Disabled, PasswordRequired, 
        PasswordChangeable, SID

<span class="token-comment"># Local groups and members</span>
<span class="token-cmdlet">Get-CimInstance</span> Win32_Group <span class="token-parameter">-Filter</span> <span class="token-string">"LocalAccount=True"</span> |
    <span class="token-cmdlet">Select-Object</span> Name, Description, SID

<span class="token-comment"># Startup commands (persistence mechanism)</span>
<span class="token-cmdlet">Get-CimInstance</span> Win32_StartupCommand | 
    <span class="token-cmdlet">Select-Object</span> Name, Command, Location, User

<span class="token-comment"># Installed software</span>
<span class="token-cmdlet">Get-CimInstance</span> Win32_Product | 
    <span class="token-cmdlet">Select-Object</span> Name, Version, Vendor, InstallDate |
    <span class="token-cmdlet">Sort-Object</span> InstallDate <span class="token-parameter">-Descending</span>

<span class="token-comment"># Faster: Query registry instead</span>
<span class="token-cmdlet">Get-CimInstance</span> <span class="token-parameter">-Query</span> @<span class="token-string">"
SELECT * FROM Win32_InstalledWin32Program
"@</span>

<span class="token-comment"># Shares (potential lateral movement paths)</span>
<span class="token-cmdlet">Get-CimInstance</span> Win32_Share | <span class="token-cmdlet">Select-Object</span> Name, Path, Description, Type

<span class="token-comment"># Logged on users</span>
<span class="token-cmdlet">Get-CimInstance</span> Win32_LoggedOnUser | <span class="token-cmdlet">ForEach-Object</span> {
    <span class="token-variable">$User</span> = [wmi]<span class="token-variable">$_</span>.Antecedent
    [PSCustomObject]@{
        Name = <span class="token-variable">$User</span>.Name
        Domain = <span class="token-variable">$User</span>.Domain
    }
} | <span class="token-cmdlet">Sort-Object</span> <span class="token-parameter">-Unique</span> Domain, Name

<span class="token-comment"># Scheduled tasks via CIM</span>
<span class="token-cmdlet">Get-CimInstance</span> <span class="token-parameter">-Namespace</span> Root\Microsoft\Windows\TaskScheduler <span class="token-parameter">-ClassName</span> MSFT_ScheduledTask |
    <span class="token-cmdlet">Select-Object</span> TaskName, State, TaskPath</code></pre>
                    </div>
                </div>

                <!-- Remote Queries -->
                <h2>Remote CIM Sessions</h2>

                <div class="code-container">
                    <div class="code-header">
                        <span class="code-language powershell">
                            <span class="code-language-icon">ğŸ”·</span>
                            PowerShell - Remote CIM
                        </span>
                        <button class="code-copy-btn"><span>ğŸ“‹</span> Copy</button>
                    </div>
                    <div class="code-block">
<pre><code><span class="token-comment"># Simple remote query</span>
<span class="token-cmdlet">Get-CimInstance</span> Win32_OperatingSystem <span class="token-parameter">-ComputerName</span> <span class="token-string">"Server01"</span>

<span class="token-comment"># Create persistent CIM session (faster for multiple queries)</span>
<span class="token-variable">$Session</span> = <span class="token-cmdlet">New-CimSession</span> <span class="token-parameter">-ComputerName</span> <span class="token-string">"Server01"</span>
<span class="token-cmdlet">Get-CimInstance</span> Win32_OperatingSystem <span class="token-parameter">-CimSession</span> <span class="token-variable">$Session</span>
<span class="token-cmdlet">Get-CimInstance</span> Win32_Process <span class="token-parameter">-CimSession</span> <span class="token-variable">$Session</span>
<span class="token-cmdlet">Remove-CimSession</span> <span class="token-variable">$Session</span>

<span class="token-comment"># With credentials</span>
<span class="token-variable">$Cred</span> = <span class="token-cmdlet">Get-Credential</span>
<span class="token-variable">$Session</span> = <span class="token-cmdlet">New-CimSession</span> <span class="token-parameter">-ComputerName</span> <span class="token-string">"Server01"</span> <span class="token-parameter">-Credential</span> <span class="token-variable">$Cred</span>

<span class="token-comment"># Multiple computers</span>
<span class="token-variable">$Servers</span> = @(<span class="token-string">"Server01"</span>, <span class="token-string">"Server02"</span>, <span class="token-string">"Server03"</span>)
<span class="token-variable">$Sessions</span> = <span class="token-cmdlet">New-CimSession</span> <span class="token-parameter">-ComputerName</span> <span class="token-variable">$Servers</span>
<span class="token-cmdlet">Get-CimInstance</span> Win32_OperatingSystem <span class="token-parameter">-CimSession</span> <span class="token-variable">$Sessions</span> |
    <span class="token-cmdlet">Select-Object</span> PSComputerName, Caption, LastBootUpTime
<span class="token-cmdlet">Remove-CimSession</span> <span class="token-variable">$Sessions</span>

<span class="token-comment"># Use DCOM (for legacy systems without WinRM)</span>
<span class="token-variable">$SessionOption</span> = <span class="token-cmdlet">New-CimSessionOption</span> <span class="token-parameter">-Protocol</span> Dcom
<span class="token-variable">$Session</span> = <span class="token-cmdlet">New-CimSession</span> <span class="token-parameter">-ComputerName</span> <span class="token-string">"OldServer"</span> <span class="token-parameter">-SessionOption</span> <span class="token-variable">$SessionOption</span>

<span class="token-comment"># Query all domain computers for specific process</span>
<span class="token-variable">$Computers</span> = (<span class="token-cmdlet">Get-ADComputer</span> <span class="token-parameter">-Filter</span> *).Name
<span class="token-keyword">foreach</span> (<span class="token-variable">$Computer</span> <span class="token-keyword">in</span> <span class="token-variable">$Computers</span>) {
    <span class="token-keyword">try</span> {
        <span class="token-cmdlet">Get-CimInstance</span> Win32_Process <span class="token-parameter">-ComputerName</span> <span class="token-variable">$Computer</span> -ErrorAction Stop |
            <span class="token-cmdlet">Where-Object</span> Name <span class="token-operator">-eq</span> <span class="token-string">'mimikatz.exe'</span> |
            <span class="token-cmdlet">Select-Object</span> @{N=<span class="token-string">'Computer'</span>;E={<span class="token-variable">$Computer</span>}}, Name, ProcessId, CommandLine
    }
    <span class="token-keyword">catch</span> {
        Write-Warning <span class="token-string">"Cannot connect to $Computer"</span>
    }
}</code></pre>
                    </div>
                </div>

                <!-- WQL Queries -->
                <h2>WQL Queries</h2>

                <div class="code-container">
                    <div class="code-header">
                        <span class="code-language powershell">
                            <span class="code-language-icon">ğŸ”·</span>
                            PowerShell - WQL (WMI Query Language)
                        </span>
                        <button class="code-copy-btn"><span>ğŸ“‹</span> Copy</button>
                    </div>
                    <div class="code-block">
<pre><code><span class="token-comment"># WQL is SQL-like syntax for WMI queries</span>
<span class="token-comment"># Faster than PowerShell Where-Object filtering</span>

<span class="token-comment"># Basic WQL query</span>
<span class="token-cmdlet">Get-CimInstance</span> <span class="token-parameter">-Query</span> <span class="token-string">"SELECT * FROM Win32_Process WHERE Name = 'explorer.exe'"</span>

<span class="token-comment"># Select specific properties</span>
<span class="token-cmdlet">Get-CimInstance</span> <span class="token-parameter">-Query</span> <span class="token-string">"SELECT Name, ProcessId, CommandLine FROM Win32_Process"</span>

<span class="token-comment"># LIKE operator for pattern matching</span>
<span class="token-cmdlet">Get-CimInstance</span> <span class="token-parameter">-Query</span> <span class="token-string">"SELECT * FROM Win32_Service WHERE Name LIKE 'Win%'"</span>

<span class="token-comment"># Multiple conditions</span>
<span class="token-cmdlet">Get-CimInstance</span> <span class="token-parameter">-Query</span> @<span class="token-string">"
SELECT * FROM Win32_Service 
WHERE State = 'Running' 
AND StartMode = 'Auto'
"@</span>

<span class="token-comment"># NOT and OR</span>
<span class="token-cmdlet">Get-CimInstance</span> <span class="token-parameter">-Query</span> @<span class="token-string">"
SELECT * FROM Win32_Process 
WHERE Name != 'System' 
AND (ParentProcessId = 0 OR ParentProcessId = 4)
"@</span>

<span class="token-comment"># Associators - find related objects</span>
<span class="token-comment"># Find all processes for a specific service</span>
<span class="token-cmdlet">Get-CimInstance</span> <span class="token-parameter">-Query</span> @<span class="token-string">"
ASSOCIATORS OF {Win32_Service.Name='Spooler'} 
WHERE AssocClass = Win32_DependentService
"@</span>

<span class="token-comment"># Security-focused: Find processes with specific parent</span>
<span class="token-variable">$CmdPID</span> = (<span class="token-cmdlet">Get-Process</span> cmd | <span class="token-cmdlet">Select-Object</span> <span class="token-parameter">-First</span> <span class="token-number">1</span>).Id
<span class="token-cmdlet">Get-CimInstance</span> <span class="token-parameter">-Query</span> <span class="token-string">"SELECT * FROM Win32_Process WHERE ParentProcessId = $CmdPID"</span></code></pre>
                    </div>
                </div>

                <!-- Best Practices -->
                <div class="info-box best-practice-box">
                    <div class="info-box-header">
                        <div class="info-box-icon">âœ…</div>
                        <div class="info-box-title">Best Practices: WMI/CIM</div>
                    </div>
                    <ul>
                        <li><strong>Use Get-CimInstance:</strong> Modern, uses WinRM, cross-platform</li>
                        <li><strong>Use -Filter or -Query:</strong> Faster than Where-Object (filters server-side)</li>
                        <li><strong>Create CIM sessions:</strong> Reuse for multiple queries to same host</li>
                        <li><strong>Select specific properties:</strong> Reduces data transfer</li>
                        <li><strong>Handle errors:</strong> Remote systems may be offline</li>
                        <li><strong>Avoid Win32_Product:</strong> Slow and triggers MSI reconfiguration</li>
                    </ul>
                </div>

                <!-- Interview Tips -->
                <div class="info-box interview-box">
                    <div class="info-box-header">
                        <div class="info-box-icon">ğŸ’¼</div>
                        <div class="info-box-title">Interview Tips</div>
                    </div>
                    <ul>
                        <li><strong>Common Question:</strong> "What's the difference between WMI and CIM cmdlets?"</li>
                        <li><strong>Strong Answer:</strong> Both access the same WMI repository, but CIM cmdlets (<code>Get-CimInstance</code>) use WS-Man/WinRM for remote access (firewall-friendly, cross-platform in PS7), while WMI cmdlets (<code>Get-WmiObject</code>) use DCOM/RPC (legacy, Windows-only). Always use CIM cmdlets for new scriptsâ€”WMI cmdlets are deprecated.</li>
                    </ul>
                </div>

                <!-- Key Takeaways -->
                <h2>Key Takeaways</h2>
                <ul>
                    <li>Use <code>Get-CimInstance</code> instead of <code>Get-WmiObject</code></li>
                    <li>Common classes: Win32_Process, Win32_Service, Win32_OperatingSystem</li>
                    <li>Use <code>-Filter</code> or <code>-Query</code> for server-side filtering</li>
                    <li>Create CIM sessions for multiple remote queries</li>
                    <li>WQL syntax is SQL-like: SELECT, WHERE, LIKE, AND, OR</li>
                    <li>CIM provides rich system data for security investigations</li>
                </ul>

                <!-- Navigation -->
                                                                                <div class="page-navigation">
                    <a href="2-8-files.html" class="nav-button prev">
                        <span class="nav-button-label">Previous</span>
                        <span class="nav-button-title">â† 2.8 Working with Files</span>
                    </a>
                    <a href="2-10-registry.html" class="nav-button next">
                        <span class="nav-button-label">Next</span>
                        <span class="nav-button-title">2.10 Registry Operations â†’</span>
                    </a>
                </div>
            </div>
        </main>
    </div>

    <!-- Search Modal -->
    <div class="search-modal" id="searchModal">
        <div class="search-modal-content">
            <input type="text" class="search-modal-input" id="searchModalInput" placeholder="Search documentation..." autocomplete="off">
            <div class="search-modal-results" id="searchResults"></div>
        </div>
    </div>

    <!-- Mobile Toggle -->
    <button class="mobile-toggle">â˜°</button>

    <script src="main.js"></script>
</body>
</html>
