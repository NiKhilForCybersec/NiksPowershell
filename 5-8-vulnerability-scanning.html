<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>5.8 Vulnerability Scanning Scripts - PowerShell & Scripting Guide</title>
    <link rel="stylesheet" href="main.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
</head>
<body>
    <div class="layout-wrapper">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo">
                    <div class="sidebar-logo-icon">ğŸ–¥ï¸</div>
                    <div class="sidebar-logo-text">
                        PowerShell & Scripting
                        <span>Ultimate Guide</span>
                    </div>
                </div>
                <div class="search-container">
                    <span class="search-icon">ğŸ”</span>
                    <input type="text" class="search-input" placeholder="Search documentation...">
                    <span class="search-shortcut">Ctrl+K</span>
                </div>
            </div>
            
            <nav class="sidebar-nav">
                <div class="nav-section collapsed" data-section="powershell">
                    <div class="nav-section-header">
                        <span class="nav-section-icon">ğŸ”·</span>
                        PowerShell Deep Dive
                        <span class="nav-section-toggle">â–¼</span>
                    </div>
                    <div class="nav-section-content">
                        <a href="2-1-powershell-intro.html" class="nav-link"><span class="nav-link-number">2.1</span> PowerShell Introduction</a>
                        <a href="2-16-active-directory.html" class="nav-link"><span class="nav-link-number">2.16</span> Active Directory</a>
                    </div>
                </div>

                <div class="nav-section" data-section="security">
                    <div class="nav-section-header">
                        <span class="nav-section-icon">ğŸ”’</span>
                        Security Automation
                        <span class="nav-section-toggle">â–¼</span>
                    </div>
                    <div class="nav-section-content">
                        <a href="5-6-incident-response-scripts.html" class="nav-link"><span class="nav-link-number">5.6</span> Incident Response Scripts</a>
                        <a href="5-7-threat-hunting-scripts.html" class="nav-link"><span class="nav-link-number">5.7</span> Threat Hunting Scripts</a>
                        <a href="5-8-vulnerability-scanning.html" class="nav-link active"><span class="nav-link-number">5.8</span> Vulnerability Scanning</a>
                        <a href="5-10-siem-integration.html" class="nav-link"><span class="nav-link-number">5.10</span> SIEM Integration</a>
                        <a href="5-11-edr-automation.html" class="nav-link"><span class="nav-link-number">5.11</span> EDR Automation</a>
                    </div>
                </div>

                <div class="nav-section collapsed" data-section="reference">
                    <div class="nav-section-header">
                        <span class="nav-section-icon">ğŸ“‹</span>
                        Best Practices & Reference
                        <span class="nav-section-toggle">â–¼</span>
                    </div>
                    <div class="nav-section-content">
                        <a href="10-5-cheat-sheets.html" class="nav-link"><span class="nav-link-number">10.5</span> Cheat Sheets</a>
                        <a href="10-6-interview-preparation.html" class="nav-link"><span class="nav-link-number">10.6</span> Interview Preparation</a>
                    </div>
                </div>
            </nav>
        </aside>

        <!-- Main Content Area -->
        <main class="main-content">
            <div class="content-wrapper">
                <!-- Breadcrumb -->
                <nav class="breadcrumb">
                    <a href="index.html">Home</a>
                    <span class="breadcrumb-separator">â€º</span>
                    <a href="index.html#security">Security Automation</a>
                    <span class="breadcrumb-separator">â€º</span>
                    <span>Vulnerability Scanning Scripts</span>
                </nav>

                <!-- Page Title -->
                <h1>5.8 Vulnerability Scanning Scripts</h1>

                <!-- What You'll Learn Box -->
                <div class="info-box overview-box">
                    <div class="info-box-header">
                        <div class="info-box-icon">ğŸ“–</div>
                        <div class="info-box-title">What You'll Learn</div>
                    </div>
                    <ul>
                        <li>Automate Windows security configuration checks</li>
                        <li>Scan for missing patches and outdated software</li>
                        <li>Check for common misconfigurations and vulnerabilities</li>
                        <li>Generate security assessment reports</li>
                    </ul>
                </div>

                <!-- Introduction -->
                <h2>Automated Security Assessment</h2>
                <p>
                    Vulnerability scanning scripts help identify security weaknesses before attackers do. 
                    These scripts automate checks for missing patches, misconfigurations, and common 
                    vulnerabilities in Windows environments.
                </p>

                <!-- Vulnerability Assessment Flow -->
                <div class="ascii-diagram">
                    <div class="ascii-diagram-title">ğŸ“Š Vulnerability Assessment Workflow</div>
<pre>
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    VULNERABILITY ASSESSMENT PIPELINE                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  PATCH   â”‚    â”‚  CONFIG  â”‚    â”‚ SERVICE  â”‚    â”‚ NETWORK  â”‚
    â”‚  STATUS  â”‚    â”‚  AUDIT   â”‚    â”‚  CHECK   â”‚    â”‚  AUDIT   â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
         â”‚               â”‚               â”‚               â”‚
         â–¼               â–¼               â–¼               â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Missing  â”‚    â”‚ Weak     â”‚    â”‚ Risky    â”‚    â”‚ Open     â”‚
    â”‚ Updates  â”‚    â”‚ Settings â”‚    â”‚ Services â”‚    â”‚ Ports    â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
         â”‚               â”‚               â”‚               â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   RISK ASSESSMENT      â”‚
                    â”‚   â€¢ Critical           â”‚
                    â”‚   â€¢ High               â”‚
                    â”‚   â€¢ Medium             â”‚
                    â”‚   â€¢ Low                â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   REMEDIATION REPORT   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</pre>
                </div>

                <!-- Memory Aid -->
                <div class="info-box memory-box">
                    <div class="info-box-header">
                        <div class="info-box-icon">ğŸ§ </div>
                        <div class="info-box-title">Memory Aid: PATCH Check Categories</div>
                    </div>
                    <ul>
                        <li><strong>P</strong>atches â†’ Missing Windows updates, third-party software</li>
                        <li><strong>A</strong>ccess â†’ Weak permissions, excessive privileges</li>
                        <li><strong>T</strong>LS/SSL â†’ Certificate issues, weak protocols</li>
                        <li><strong>C</strong>onfiguration â†’ Security settings, GPO compliance</li>
                        <li><strong>H</strong>ardening â†’ Unnecessary services, open ports</li>
                    </ul>
                </div>

                <!-- Patch Status Check -->
                <h2>Windows Update Status</h2>

                <div class="code-container">
                    <div class="code-header">
                        <span class="code-language powershell">
                            <span class="code-language-icon">ğŸ”·</span>
                            PowerShell - Check Missing Updates
                        </span>
                        <button class="code-copy-btn"><span>ğŸ“‹</span> Copy</button>
                    </div>
                    <div class="code-block">
<pre><code><span class="token-keyword">function</span> <span class="token-function">Get-MissingUpdates</span> {
    <span class="token-comment">&lt;#
    .SYNOPSIS
        Checks for missing Windows updates.
    #&gt;</span>
    [CmdletBinding()]
    <span class="token-keyword">param</span>(
        [string]<span class="token-variable">$ComputerName</span> = <span class="token-variable">$env:COMPUTERNAME</span>
    )
    
    Write-Host <span class="token-string">"[*] Checking Windows Update status on $ComputerName..."</span> -ForegroundColor Cyan
    
    <span class="token-keyword">try</span> {
        <span class="token-comment"># Create Windows Update Session</span>
        <span class="token-variable">$UpdateSession</span> = <span class="token-cmdlet">New-Object</span> -ComObject Microsoft.Update.Session
        <span class="token-variable">$UpdateSearcher</span> = <span class="token-variable">$UpdateSession</span>.CreateUpdateSearcher()
        
        <span class="token-comment"># Search for missing updates</span>
        Write-Host <span class="token-string">"[*] Searching for updates (this may take a few minutes)..."</span>
        <span class="token-variable">$SearchResult</span> = <span class="token-variable">$UpdateSearcher</span>.Search(<span class="token-string">"IsInstalled=0 and Type='Software'"</span>)
        
        <span class="token-variable">$Updates</span> = @()
        <span class="token-keyword">foreach</span> (<span class="token-variable">$Update</span> <span class="token-keyword">in</span> <span class="token-variable">$SearchResult</span>.Updates) {
            <span class="token-variable">$Severity</span> = <span class="token-keyword">switch</span> (<span class="token-variable">$Update</span>.MsrcSeverity) {
                <span class="token-string">'Critical'</span> { <span class="token-string">'CRITICAL'</span> }
                <span class="token-string">'Important'</span> { <span class="token-string">'HIGH'</span> }
                <span class="token-string">'Moderate'</span> { <span class="token-string">'MEDIUM'</span> }
                <span class="token-string">'Low'</span> { <span class="token-string">'LOW'</span> }
                default { <span class="token-string">'UNKNOWN'</span> }
            }
            
            <span class="token-variable">$Updates</span> += [PSCustomObject]@{
                Title = <span class="token-variable">$Update</span>.Title
                KB = (<span class="token-variable">$Update</span>.KBArticleIDs -join <span class="token-string">', '</span>)
                Severity = <span class="token-variable">$Severity</span>
                Category = (<span class="token-variable">$Update</span>.Categories | <span class="token-cmdlet">Select-Object</span> <span class="token-parameter">-First</span> <span class="token-number">1</span>).Name
                Size = <span class="token-string">"$([math]::Round($Update.MaxDownloadSize / 1MB, 2)) MB"</span>
                IsSecurityUpdate = <span class="token-variable">$Update</span>.Categories | <span class="token-cmdlet">Where-Object</span> { <span class="token-variable">$_</span>.Name <span class="token-operator">-match</span> <span class="token-string">'Security'</span> }
            }
        }
        
        <span class="token-comment"># Summary</span>
        <span class="token-variable">$Critical</span> = (<span class="token-variable">$Updates</span> | <span class="token-cmdlet">Where-Object</span> Severity <span class="token-operator">-eq</span> <span class="token-string">'CRITICAL'</span>).Count
        <span class="token-variable">$High</span> = (<span class="token-variable">$Updates</span> | <span class="token-cmdlet">Where-Object</span> Severity <span class="token-operator">-eq</span> <span class="token-string">'HIGH'</span>).Count
        
        Write-Host <span class="token-string">"`n=== Update Summary ==="</span> -ForegroundColor Yellow
        Write-Host <span class="token-string">"Total Missing: $($Updates.Count)"</span>
        Write-Host <span class="token-string">"Critical: $Critical"</span> -ForegroundColor Red
        Write-Host <span class="token-string">"High: $High"</span> -ForegroundColor DarkYellow
        
        <span class="token-keyword">return</span> <span class="token-variable">$Updates</span>
    }
    <span class="token-keyword">catch</span> {
        Write-Error <span class="token-string">"Failed to check updates: $_"</span>
    }
}

<span class="token-comment"># Get installed hotfixes (quick check)</span>
<span class="token-keyword">function</span> <span class="token-function">Get-RecentPatches</span> {
    <span class="token-keyword">param</span>([int]<span class="token-variable">$DaysBack</span> = <span class="token-number">30</span>)
    
    <span class="token-variable">$CutoffDate</span> = (Get-Date).AddDays(-<span class="token-variable">$DaysBack</span>)
    
    <span class="token-cmdlet">Get-HotFix</span> | <span class="token-cmdlet">Where-Object</span> InstalledOn <span class="token-operator">-gt</span> <span class="token-variable">$CutoffDate</span> |
        <span class="token-cmdlet">Sort-Object</span> InstalledOn <span class="token-parameter">-Descending</span> |
        <span class="token-cmdlet">Select-Object</span> HotFixID, Description, InstalledOn, InstalledBy
}</code></pre>
                    </div>
                </div>

                <!-- Security Configuration Check -->
                <h2>Security Configuration Audit</h2>

                <div class="code-container">
                    <div class="code-header">
                        <span class="code-language powershell">
                            <span class="code-language-icon">ğŸ”·</span>
                            PowerShell - Security Settings Audit
                        </span>
                        <button class="code-copy-btn"><span>ğŸ“‹</span> Copy</button>
                    </div>
                    <div class="code-block">
<pre><code><span class="token-keyword">function</span> <span class="token-function">Get-SecurityConfigAudit</span> {
    <span class="token-comment">&lt;#
    .SYNOPSIS
        Audits Windows security configuration settings.
    #&gt;</span>
    
    <span class="token-variable">$Findings</span> = @()
    
    Write-Host <span class="token-string">"[*] Auditing security configuration..."</span> -ForegroundColor Cyan
    
    <span class="token-comment"># 1. Check if Windows Firewall is enabled</span>
    Write-Host <span class="token-string">"  [*] Checking Windows Firewall..."</span>
    <span class="token-variable">$FwProfiles</span> = <span class="token-cmdlet">Get-NetFirewallProfile</span>
    <span class="token-keyword">foreach</span> (<span class="token-variable">$Profile</span> <span class="token-keyword">in</span> <span class="token-variable">$FwProfiles</span>) {
        <span class="token-keyword">if</span> (<span class="token-variable">$Profile</span>.Enabled <span class="token-operator">-eq</span> <span class="token-variable">$false</span>) {
            <span class="token-variable">$Findings</span> += [PSCustomObject]@{
                Category = <span class="token-string">'Firewall'</span>
                Finding = <span class="token-string">"$($Profile.Name) profile is DISABLED"</span>
                Severity = <span class="token-string">'HIGH'</span>
                Recommendation = <span class="token-string">"Enable Windows Firewall for $($Profile.Name) profile"</span>
            }
        }
    }
    
    <span class="token-comment"># 2. Check UAC settings</span>
    Write-Host <span class="token-string">"  [*] Checking UAC settings..."</span>
    <span class="token-variable">$UAC</span> = <span class="token-cmdlet">Get-ItemProperty</span> <span class="token-string">"HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System"</span>
    <span class="token-keyword">if</span> (<span class="token-variable">$UAC</span>.EnableLUA <span class="token-operator">-eq</span> <span class="token-number">0</span>) {
        <span class="token-variable">$Findings</span> += [PSCustomObject]@{
            Category = <span class="token-string">'UAC'</span>
            Finding = <span class="token-string">"User Account Control is DISABLED"</span>
            Severity = <span class="token-string">'CRITICAL'</span>
            Recommendation = <span class="token-string">"Enable UAC in Control Panel or via Group Policy"</span>
        }
    }
    <span class="token-keyword">if</span> (<span class="token-variable">$UAC</span>.ConsentPromptBehaviorAdmin <span class="token-operator">-eq</span> <span class="token-number">0</span>) {
        <span class="token-variable">$Findings</span> += [PSCustomObject]@{
            Category = <span class="token-string">'UAC'</span>
            Finding = <span class="token-string">"UAC does not prompt for elevation"</span>
            Severity = <span class="token-string">'HIGH'</span>
            Recommendation = <span class="token-string">"Set ConsentPromptBehaviorAdmin to prompt on secure desktop"</span>
        }
    }
    
    <span class="token-comment"># 3. Check password policy</span>
    Write-Host <span class="token-string">"  [*] Checking password policy..."</span>
    <span class="token-variable">$SecPolicy</span> = net accounts 2>&1
    <span class="token-keyword">if</span> (<span class="token-variable">$SecPolicy</span> <span class="token-operator">-match</span> <span class="token-string">'Minimum password length:\s*(\d+)'</span>) {
        <span class="token-variable">$MinLength</span> = [int]<span class="token-variable">$Matches</span>[1]
        <span class="token-keyword">if</span> (<span class="token-variable">$MinLength</span> <span class="token-operator">-lt</span> <span class="token-number">12</span>) {
            <span class="token-variable">$Findings</span> += [PSCustomObject]@{
                Category = <span class="token-string">'Password Policy'</span>
                Finding = <span class="token-string">"Minimum password length is $MinLength (should be 12+)"</span>
                Severity = <span class="token-string">'MEDIUM'</span>
                Recommendation = <span class="token-string">"Increase minimum password length to 12 characters"</span>
            }
        }
    }
    
    <span class="token-comment"># 4. Check for Guest account</span>
    Write-Host <span class="token-string">"  [*] Checking Guest account..."</span>
    <span class="token-variable">$Guest</span> = <span class="token-cmdlet">Get-LocalUser</span> <span class="token-parameter">-Name</span> <span class="token-string">"Guest"</span> -ErrorAction SilentlyContinue
    <span class="token-keyword">if</span> (<span class="token-variable">$Guest</span> <span class="token-operator">-and</span> <span class="token-variable">$Guest</span>.Enabled) {
        <span class="token-variable">$Findings</span> += [PSCustomObject]@{
            Category = <span class="token-string">'User Accounts'</span>
            Finding = <span class="token-string">"Guest account is ENABLED"</span>
            Severity = <span class="token-string">'HIGH'</span>
            Recommendation = <span class="token-string">"Disable the Guest account"</span>
        }
    }
    
    <span class="token-comment"># 5. Check RDP settings</span>
    Write-Host <span class="token-string">"  [*] Checking RDP settings..."</span>
    <span class="token-variable">$RDP</span> = <span class="token-cmdlet">Get-ItemProperty</span> <span class="token-string">"HKLM:\SYSTEM\CurrentControlSet\Control\Terminal Server"</span> -ErrorAction SilentlyContinue
    <span class="token-keyword">if</span> (<span class="token-variable">$RDP</span>.fDenyTSConnections <span class="token-operator">-eq</span> <span class="token-number">0</span>) {
        <span class="token-variable">$NLA</span> = <span class="token-cmdlet">Get-ItemProperty</span> <span class="token-string">"HKLM:\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp"</span> -ErrorAction SilentlyContinue
        <span class="token-keyword">if</span> (<span class="token-variable">$NLA</span>.UserAuthentication <span class="token-operator">-ne</span> <span class="token-number">1</span>) {
            <span class="token-variable">$Findings</span> += [PSCustomObject]@{
                Category = <span class="token-string">'Remote Desktop'</span>
                Finding = <span class="token-string">"RDP enabled without Network Level Authentication (NLA)"</span>
                Severity = <span class="token-string">'HIGH'</span>
                Recommendation = <span class="token-string">"Enable NLA for Remote Desktop connections"</span>
            }
        }
    }
    
    <span class="token-comment"># 6. Check SMBv1</span>
    Write-Host <span class="token-string">"  [*] Checking SMBv1 status..."</span>
    <span class="token-variable">$SMB1</span> = <span class="token-cmdlet">Get-SmbServerConfiguration</span> | <span class="token-cmdlet">Select-Object</span> EnableSMB1Protocol
    <span class="token-keyword">if</span> (<span class="token-variable">$SMB1</span>.EnableSMB1Protocol <span class="token-operator">-eq</span> <span class="token-variable">$true</span>) {
        <span class="token-variable">$Findings</span> += [PSCustomObject]@{
            Category = <span class="token-string">'SMB'</span>
            Finding = <span class="token-string">"SMBv1 is ENABLED (vulnerable to EternalBlue)"</span>
            Severity = <span class="token-string">'CRITICAL'</span>
            Recommendation = <span class="token-string">"Disable SMBv1: Set-SmbServerConfiguration -EnableSMB1Protocol `$false"</span>
        }
    }
    
    <span class="token-comment"># 7. Check Windows Defender status</span>
    Write-Host <span class="token-string">"  [*] Checking Windows Defender..."</span>
    <span class="token-keyword">try</span> {
        <span class="token-variable">$Defender</span> = <span class="token-cmdlet">Get-MpComputerStatus</span> -ErrorAction Stop
        <span class="token-keyword">if</span> (<span class="token-variable">$Defender</span>.RealTimeProtectionEnabled <span class="token-operator">-eq</span> <span class="token-variable">$false</span>) {
            <span class="token-variable">$Findings</span> += [PSCustomObject]@{
                Category = <span class="token-string">'Antivirus'</span>
                Finding = <span class="token-string">"Windows Defender Real-Time Protection is DISABLED"</span>
                Severity = <span class="token-string">'CRITICAL'</span>
                Recommendation = <span class="token-string">"Enable Real-Time Protection in Windows Security"</span>
            }
        }
        <span class="token-keyword">if</span> (<span class="token-variable">$Defender</span>.AntivirusSignatureAge <span class="token-operator">-gt</span> <span class="token-number">7</span>) {
            <span class="token-variable">$Findings</span> += [PSCustomObject]@{
                Category = <span class="token-string">'Antivirus'</span>
                Finding = <span class="token-string">"Antivirus signatures are $($Defender.AntivirusSignatureAge) days old"</span>
                Severity = <span class="token-string">'HIGH'</span>
                Recommendation = <span class="token-string">"Update Windows Defender signatures"</span>
            }
        }
    } <span class="token-keyword">catch</span> { }
    
    <span class="token-keyword">return</span> <span class="token-variable">$Findings</span>
}</code></pre>
                    </div>
                </div>

                <!-- Service Audit -->
                <h2>Risky Services Audit</h2>

                <div class="code-container">
                    <div class="code-header">
                        <span class="code-language powershell">
                            <span class="code-language-icon">ğŸ”·</span>
                            PowerShell - Service Security Audit
                        </span>
                        <button class="code-copy-btn"><span>ğŸ“‹</span> Copy</button>
                    </div>
                    <div class="code-block">
<pre><code><span class="token-keyword">function</span> <span class="token-function">Get-RiskyServices</span> {
    <span class="token-comment">&lt;#
    .SYNOPSIS
        Identifies potentially risky or unnecessary services.
    #&gt;</span>
    
    <span class="token-comment"># Services that should typically be disabled</span>
    <span class="token-variable">$RiskyServices</span> = @{
        <span class="token-string">'RemoteRegistry'</span> = @{
            Risk = <span class="token-string">'HIGH'</span>
            Reason = <span class="token-string">'Allows remote registry modification'</span>
        }
        <span class="token-string">'Telnet'</span> = @{
            Risk = <span class="token-string">'CRITICAL'</span>
            Reason = <span class="token-string">'Unencrypted remote access protocol'</span>
        }
        <span class="token-string">'SNMP'</span> = @{
            Risk = <span class="token-string">'MEDIUM'</span>
            Reason = <span class="token-string">'Network management, often misconfigured'</span>
        }
        <span class="token-string">'SSDPSRV'</span> = @{
            Risk = <span class="token-string">'MEDIUM'</span>
            Reason = <span class="token-string">'SSDP Discovery Service - UPnP'</span>
        }
        <span class="token-string">'upnphost'</span> = @{
            Risk = <span class="token-string">'MEDIUM'</span>
            Reason = <span class="token-string">'UPnP Device Host - network exposure'</span>
        }
        <span class="token-string">'WinRM'</span> = @{
            Risk = <span class="token-string">'MEDIUM'</span>
            Reason = <span class="token-string">'Remote management - ensure properly secured'</span>
        }
        <span class="token-string">'FTP Publishing Service'</span> = @{
            Risk = <span class="token-string">'HIGH'</span>
            Reason = <span class="token-string">'FTP often transmits credentials in cleartext'</span>
        }
    }
    
    <span class="token-variable">$Findings</span> = @()
    
    Write-Host <span class="token-string">"[*] Checking for risky services..."</span> -ForegroundColor Cyan
    
    <span class="token-keyword">foreach</span> (<span class="token-variable">$ServiceName</span> <span class="token-keyword">in</span> <span class="token-variable">$RiskyServices</span>.Keys) {
        <span class="token-variable">$Service</span> = <span class="token-cmdlet">Get-Service</span> <span class="token-parameter">-Name</span> <span class="token-variable">$ServiceName</span> -ErrorAction SilentlyContinue
        <span class="token-keyword">if</span> (<span class="token-variable">$Service</span> <span class="token-operator">-and</span> <span class="token-variable">$Service</span>.Status <span class="token-operator">-eq</span> <span class="token-string">'Running'</span>) {
            <span class="token-variable">$Findings</span> += [PSCustomObject]@{
                ServiceName = <span class="token-variable">$ServiceName</span>
                DisplayName = <span class="token-variable">$Service</span>.DisplayName
                Status = <span class="token-variable">$Service</span>.Status
                StartType = <span class="token-variable">$Service</span>.StartType
                Risk = <span class="token-variable">$RiskyServices</span>[<span class="token-variable">$ServiceName</span>].Risk
                Reason = <span class="token-variable">$RiskyServices</span>[<span class="token-variable">$ServiceName</span>].Reason
            }
        }
    }
    
    <span class="token-comment"># Check for services running as LocalSystem that shouldn't be</span>
    Write-Host <span class="token-string">"[*] Checking service account privileges..."</span>
    <span class="token-variable">$HighPrivServices</span> = <span class="token-cmdlet">Get-CimInstance</span> Win32_Service | 
        <span class="token-cmdlet">Where-Object</span> { <span class="token-variable">$_</span>.StartName <span class="token-operator">-eq</span> <span class="token-string">'LocalSystem'</span> <span class="token-operator">-and</span> <span class="token-variable">$_</span>.State <span class="token-operator">-eq</span> <span class="token-string">'Running'</span> } |
        <span class="token-cmdlet">Where-Object</span> { <span class="token-variable">$_</span>.PathName <span class="token-operator">-notmatch</span> <span class="token-string">'System32|SysWOW64'</span> }
    
    <span class="token-keyword">foreach</span> (<span class="token-variable">$Svc</span> <span class="token-keyword">in</span> <span class="token-variable">$HighPrivServices</span>) {
        <span class="token-variable">$Findings</span> += [PSCustomObject]@{
            ServiceName = <span class="token-variable">$Svc</span>.Name
            DisplayName = <span class="token-variable">$Svc</span>.DisplayName
            Status = <span class="token-variable">$Svc</span>.State
            StartType = <span class="token-variable">$Svc</span>.StartMode
            Risk = <span class="token-string">'MEDIUM'</span>
            Reason = <span class="token-string">"Non-system service running as LocalSystem: $($Svc.PathName)"</span>
        }
    }
    
    <span class="token-keyword">return</span> <span class="token-variable">$Findings</span>
}</code></pre>
                    </div>
                </div>

                <!-- Open Ports Audit -->
                <h2>Open Ports Analysis</h2>

                <div class="code-container">
                    <div class="code-header">
                        <span class="code-language powershell">
                            <span class="code-language-icon">ğŸ”·</span>
                            PowerShell - Port Security Analysis
                        </span>
                        <button class="code-copy-btn"><span>ğŸ“‹</span> Copy</button>
                    </div>
                    <div class="code-block">
<pre><code><span class="token-keyword">function</span> <span class="token-function">Get-OpenPortsAudit</span> {
    <span class="token-comment">&lt;#
    .SYNOPSIS
        Audits listening ports and identifies potential risks.
    #&gt;</span>
    
    <span class="token-comment"># Define risky ports</span>
    <span class="token-variable">$RiskyPorts</span> = @{
        21 = @{ Service = <span class="token-string">'FTP'</span>; Risk = <span class="token-string">'HIGH'</span>; Note = <span class="token-string">'Cleartext credentials'</span> }
        23 = @{ Service = <span class="token-string">'Telnet'</span>; Risk = <span class="token-string">'CRITICAL'</span>; Note = <span class="token-string">'Unencrypted remote access'</span> }
        25 = @{ Service = <span class="token-string">'SMTP'</span>; Risk = <span class="token-string">'MEDIUM'</span>; Note = <span class="token-string">'Email relay potential'</span> }
        135 = @{ Service = <span class="token-string">'RPC'</span>; Risk = <span class="token-string">'MEDIUM'</span>; Note = <span class="token-string">'RPC endpoint mapper'</span> }
        137 = @{ Service = <span class="token-string">'NetBIOS-NS'</span>; Risk = <span class="token-string">'MEDIUM'</span>; Note = <span class="token-string">'NetBIOS name service'</span> }
        139 = @{ Service = <span class="token-string">'NetBIOS-SSN'</span>; Risk = <span class="token-string">'HIGH'</span>; Note = <span class="token-string">'SMB over NetBIOS'</span> }
        445 = @{ Service = <span class="token-string">'SMB'</span>; Risk = <span class="token-string">'HIGH'</span>; Note = <span class="token-string">'File sharing, lateral movement'</span> }
        1433 = @{ Service = <span class="token-string">'MSSQL'</span>; Risk = <span class="token-string">'HIGH'</span>; Note = <span class="token-string">'Database server'</span> }
        3306 = @{ Service = <span class="token-string">'MySQL'</span>; Risk = <span class="token-string">'HIGH'</span>; Note = <span class="token-string">'Database server'</span> }
        3389 = @{ Service = <span class="token-string">'RDP'</span>; Risk = <span class="token-string">'HIGH'</span>; Note = <span class="token-string">'Remote desktop'</span> }
        5432 = @{ Service = <span class="token-string">'PostgreSQL'</span>; Risk = <span class="token-string">'HIGH'</span>; Note = <span class="token-string">'Database server'</span> }
        5985 = @{ Service = <span class="token-string">'WinRM-HTTP'</span>; Risk = <span class="token-string">'MEDIUM'</span>; Note = <span class="token-string">'PS Remoting'</span> }
        5986 = @{ Service = <span class="token-string">'WinRM-HTTPS'</span>; Risk = <span class="token-string">'LOW'</span>; Note = <span class="token-string">'PS Remoting (encrypted)'</span> }
    }
    
    Write-Host <span class="token-string">"[*] Analyzing listening ports..."</span> -ForegroundColor Cyan
    
    <span class="token-variable">$ListeningPorts</span> = <span class="token-cmdlet">Get-NetTCPConnection</span> <span class="token-parameter">-State</span> Listen | <span class="token-cmdlet">ForEach-Object</span> {
        <span class="token-variable">$Port</span> = <span class="token-variable">$_</span>.LocalPort
        <span class="token-variable">$Process</span> = <span class="token-cmdlet">Get-Process</span> <span class="token-parameter">-Id</span> <span class="token-variable">$_</span>.OwningProcess -ErrorAction SilentlyContinue
        
        <span class="token-variable">$RiskInfo</span> = <span class="token-variable">$RiskyPorts</span>[<span class="token-variable">$Port</span>]
        
        [PSCustomObject]@{
            Port = <span class="token-variable">$Port</span>
            LocalAddress = <span class="token-variable">$_</span>.LocalAddress
            ProcessName = <span class="token-variable">$Process</span>.Name
            ProcessPath = <span class="token-variable">$Process</span>.Path
            Service = <span class="token-keyword">if</span> (<span class="token-variable">$RiskInfo</span>) { <span class="token-variable">$RiskInfo</span>.Service } <span class="token-keyword">else</span> { <span class="token-string">'Unknown'</span> }
            Risk = <span class="token-keyword">if</span> (<span class="token-variable">$RiskInfo</span>) { <span class="token-variable">$RiskInfo</span>.Risk } <span class="token-keyword">else</span> { <span class="token-string">'INFO'</span> }
            Note = <span class="token-keyword">if</span> (<span class="token-variable">$RiskInfo</span>) { <span class="token-variable">$RiskInfo</span>.Note } <span class="token-keyword">else</span> { <span class="token-string">''</span> }
            ExternallyAccessible = <span class="token-variable">$_</span>.LocalAddress <span class="token-operator">-eq</span> <span class="token-string">'0.0.0.0'</span> <span class="token-operator">-or</span> <span class="token-variable">$_</span>.LocalAddress <span class="token-operator">-eq</span> <span class="token-string">'::'</span>
        }
    }
    
    <span class="token-comment"># Filter to risky ports that are externally accessible</span>
    <span class="token-variable">$RiskyOpen</span> = <span class="token-variable">$ListeningPorts</span> | <span class="token-cmdlet">Where-Object</span> { 
        <span class="token-variable">$_</span>.Risk <span class="token-operator">-in</span> @(<span class="token-string">'CRITICAL'</span>, <span class="token-string">'HIGH'</span>) <span class="token-operator">-and</span> <span class="token-variable">$_</span>.ExternallyAccessible 
    }
    
    Write-Host <span class="token-string">"`n=== High-Risk Open Ports ==="</span> -ForegroundColor Yellow
    <span class="token-variable">$RiskyOpen</span> | <span class="token-cmdlet">Format-Table</span> Port, Service, ProcessName, Risk, Note <span class="token-parameter">-AutoSize</span>
    
    <span class="token-keyword">return</span> <span class="token-variable">$ListeningPorts</span>
}</code></pre>
                    </div>
                </div>

                <!-- Complete Assessment -->
                <h2>Complete Security Assessment</h2>

                <div class="code-container">
                    <div class="code-header">
                        <span class="code-language powershell">
                            <span class="code-language-icon">ğŸ”·</span>
                            PowerShell - Full Security Assessment
                        </span>
                        <button class="code-copy-btn"><span>ğŸ“‹</span> Copy</button>
                    </div>
                    <div class="code-block">
<pre><code><span class="token-keyword">function</span> <span class="token-function">Invoke-SecurityAssessment</span> {
    <span class="token-comment">&lt;#
    .SYNOPSIS
        Runs a comprehensive security assessment.
    .PARAMETER OutputPath
        Path to save the HTML report.
    #&gt;</span>
    [CmdletBinding()]
    <span class="token-keyword">param</span>(
        [string]<span class="token-variable">$OutputPath</span> = <span class="token-string">".\SecurityAssessment_$(Get-Date -Format 'yyyyMMdd_HHmmss').html"</span>
    )
    
    Write-Host @<span class="token-string">"
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘           SECURITY VULNERABILITY ASSESSMENT               â•‘
â•‘                $(Get-Date -Format 'yyyy-MM-dd HH:mm:ss')                    â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
"@</span> -ForegroundColor Cyan
    
    <span class="token-variable">$AllFindings</span> = @()
    
    <span class="token-comment"># Run all checks</span>
    Write-Host <span class="token-string">"`n[1/4] Security Configuration Audit"</span> -ForegroundColor Yellow
    <span class="token-variable">$ConfigFindings</span> = Get-SecurityConfigAudit
    <span class="token-variable">$AllFindings</span> += <span class="token-variable">$ConfigFindings</span>
    
    Write-Host <span class="token-string">"`n[2/4] Risky Services Audit"</span> -ForegroundColor Yellow
    <span class="token-variable">$ServiceFindings</span> = Get-RiskyServices
    <span class="token-variable">$AllFindings</span> += <span class="token-variable">$ServiceFindings</span> | <span class="token-cmdlet">ForEach-Object</span> {
        [PSCustomObject]@{
            Category = <span class="token-string">'Services'</span>
            Finding = <span class="token-string">"$($_.DisplayName) is running"</span>
            Severity = <span class="token-variable">$_</span>.Risk
            Recommendation = <span class="token-variable">$_</span>.Reason
        }
    }
    
    Write-Host <span class="token-string">"`n[3/4] Open Ports Analysis"</span> -ForegroundColor Yellow
    <span class="token-variable">$PortFindings</span> = Get-OpenPortsAudit
    <span class="token-variable">$RiskyPorts</span> = <span class="token-variable">$PortFindings</span> | <span class="token-cmdlet">Where-Object</span> { <span class="token-variable">$_</span>.Risk <span class="token-operator">-in</span> @(<span class="token-string">'CRITICAL'</span>, <span class="token-string">'HIGH'</span>) <span class="token-operator">-and</span> <span class="token-variable">$_</span>.ExternallyAccessible }
    <span class="token-variable">$AllFindings</span> += <span class="token-variable">$RiskyPorts</span> | <span class="token-cmdlet">ForEach-Object</span> {
        [PSCustomObject]@{
            Category = <span class="token-string">'Network'</span>
            Finding = <span class="token-string">"Port $($_.Port) ($($_.Service)) externally accessible"</span>
            Severity = <span class="token-variable">$_</span>.Risk
            Recommendation = <span class="token-variable">$_</span>.Note
        }
    }
    
    Write-Host <span class="token-string">"`n[4/4] Local Admin Check"</span> -ForegroundColor Yellow
    <span class="token-variable">$LocalAdmins</span> = <span class="token-cmdlet">Get-LocalGroupMember</span> <span class="token-parameter">-Group</span> <span class="token-string">"Administrators"</span> -ErrorAction SilentlyContinue
    <span class="token-keyword">if</span> (<span class="token-variable">$LocalAdmins</span>.Count <span class="token-operator">-gt</span> <span class="token-number">3</span>) {
        <span class="token-variable">$AllFindings</span> += [PSCustomObject]@{
            Category = <span class="token-string">'Privileges'</span>
            Finding = <span class="token-string">"$($LocalAdmins.Count) members in local Administrators group"</span>
            Severity = <span class="token-string">'MEDIUM'</span>
            Recommendation = <span class="token-string">'Review and minimize local admin membership'</span>
        }
    }
    
    <span class="token-comment"># Summary</span>
    Write-Host <span class="token-string">"`n"</span> + (<span class="token-string">"="</span> * <span class="token-number">60</span>) -ForegroundColor Cyan
    Write-Host <span class="token-string">"                    ASSESSMENT SUMMARY"</span> -ForegroundColor Cyan
    Write-Host (<span class="token-string">"="</span> * <span class="token-number">60</span>) -ForegroundColor Cyan
    
    <span class="token-variable">$Critical</span> = (<span class="token-variable">$AllFindings</span> | <span class="token-cmdlet">Where-Object</span> Severity <span class="token-operator">-eq</span> <span class="token-string">'CRITICAL'</span>).Count
    <span class="token-variable">$High</span> = (<span class="token-variable">$AllFindings</span> | <span class="token-cmdlet">Where-Object</span> Severity <span class="token-operator">-eq</span> <span class="token-string">'HIGH'</span>).Count
    <span class="token-variable">$Medium</span> = (<span class="token-variable">$AllFindings</span> | <span class="token-cmdlet">Where-Object</span> Severity <span class="token-operator">-eq</span> <span class="token-string">'MEDIUM'</span>).Count
    <span class="token-variable">$Low</span> = (<span class="token-variable">$AllFindings</span> | <span class="token-cmdlet">Where-Object</span> Severity <span class="token-operator">-eq</span> <span class="token-string">'LOW'</span>).Count
    
    Write-Host <span class="token-string">"Total Findings: $($AllFindings.Count)"</span>
    Write-Host <span class="token-string">"  CRITICAL: $Critical"</span> -ForegroundColor Red
    Write-Host <span class="token-string">"  HIGH:     $High"</span> -ForegroundColor DarkYellow
    Write-Host <span class="token-string">"  MEDIUM:   $Medium"</span> -ForegroundColor Yellow
    Write-Host <span class="token-string">"  LOW:      $Low"</span> -ForegroundColor Green
    
    <span class="token-comment"># Export to CSV</span>
    <span class="token-variable">$CsvPath</span> = <span class="token-variable">$OutputPath</span> <span class="token-operator">-replace</span> <span class="token-string">'\.html$'</span>, <span class="token-string">'.csv'</span>
    <span class="token-variable">$AllFindings</span> | <span class="token-cmdlet">Export-Csv</span> <span class="token-parameter">-Path</span> <span class="token-variable">$CsvPath</span> <span class="token-parameter">-NoTypeInformation</span>
    Write-Host <span class="token-string">"`n[+] Report saved to: $CsvPath"</span> -ForegroundColor Green
    
    <span class="token-keyword">return</span> <span class="token-variable">$AllFindings</span>
}

<span class="token-comment"># Run assessment</span>
<span class="token-variable">$Results</span> = Invoke-SecurityAssessment</code></pre>
                    </div>
                </div>

                <!-- Best Practices -->
                <div class="info-box best-practice-box">
                    <div class="info-box-header">
                        <div class="info-box-icon">âœ…</div>
                        <div class="info-box-title">Best Practices: Vulnerability Scanning</div>
                    </div>
                    <ul>
                        <li><strong>Schedule regular scans:</strong> Weekly for configuration, daily for patch status</li>
                        <li><strong>Prioritize by risk:</strong> Address CRITICAL and HIGH findings first</li>
                        <li><strong>Document exceptions:</strong> Track accepted risks with business justification</li>
                        <li><strong>Correlate with threat intel:</strong> Prioritize actively exploited vulnerabilities</li>
                        <li><strong>Automate remediation:</strong> Script fixes for common issues where safe</li>
                        <li><strong>Track trends:</strong> Monitor finding counts over time</li>
                    </ul>
                </div>

                <!-- Interview Tips -->
                <div class="info-box interview-box">
                    <div class="info-box-header">
                        <div class="info-box-icon">ğŸ’¼</div>
                        <div class="info-box-title">Interview Tips</div>
                    </div>
                    <ul>
                        <li><strong>Common Question:</strong> "How do you approach vulnerability management?"</li>
                        <li><strong>Strong Answer:</strong> Use a risk-based approach: inventory assets, scan regularly with multiple tools (agent-based + network), prioritize by CVSS score and business impact, track remediation SLAs (Critical: 7 days, High: 30 days, Medium: 90 days). Integrate with patch management and change control processes. Monitor for false positives and exceptions.</li>
                        <li><strong>Bonus:</strong> Mention specific tools (Nessus, Qualys, Rapid7), CVSS scoring, and compensating controls for items that can't be patched.</li>
                    </ul>
                </div>

                <!-- Key Takeaways -->
                <h2>Key Takeaways</h2>
                <ul>
                    <li>Automate security configuration checks for consistent baseline enforcement</li>
                    <li>Check Windows Update status regularlyâ€”missing patches are top attack vectors</li>
                    <li>Disable unnecessary services, especially legacy protocols (SMBv1, Telnet)</li>
                    <li>Monitor open ports and restrict external access where possible</li>
                    <li>Generate reports for tracking trends and compliance evidence</li>
                    <li>Prioritize findings by risk and actively exploited vulnerabilities</li>
                </ul>

                <!-- Navigation -->
                <div class="page-navigation">
                    <a href="5-7-threat-hunting-scripts.html" class="nav-button prev">
                        <span class="nav-button-label">Previous</span>
                        <span class="nav-button-title">â† 5.7 Threat Hunting Scripts</span>
                    </a>
                    <a href="5-9-forensics-scripts.html" class="nav-button next">
                        <span class="nav-button-label">Next</span>
                        <span class="nav-button-title">5.9 Forensics Scripts â†’</span>
                    </a>
                </div>
            </div>
        </main>
    </div>

    <!-- Search Modal -->
    <div class="search-modal" id="searchModal">
        <div class="search-modal-content">
            <input type="text" class="search-modal-input" id="searchModalInput" placeholder="Search documentation..." autocomplete="off">
            <div class="search-modal-results" id="searchResults"></div>
        </div>
    </div>

    <!-- Mobile Toggle -->
    <button class="mobile-toggle">â˜°</button>

    <script src="main.js"></script>
</body>
</html>
