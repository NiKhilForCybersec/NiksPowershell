<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>5.9 Malware Analysis Scripts - PowerShell & Scripting Guide</title>
    <link rel="stylesheet" href="main.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
</head>
<body>
    <div class="layout-wrapper">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo">
                    <div class="sidebar-logo-icon">üñ•Ô∏è</div>
                    <div class="sidebar-logo-text">
                        PowerShell & Scripting
                        <span>Ultimate Guide</span>
                    </div>
                </div>
                <div class="search-container">
                    <span class="search-icon">üîç</span>
                    <input type="text" class="search-input" placeholder="Search documentation...">
                    <span class="search-shortcut">Ctrl+K</span>
                </div>
            </div>
            
                        <nav class="sidebar-nav">
                <!-- Section 1: Scripting Fundamentals -->
                <div class="nav-section" data-section="fundamentals">
                    <div class="nav-section-header">
                        <span class="nav-section-icon">üìö</span>
                        Scripting Fundamentals
                        <span class="nav-section-toggle">‚ñº</span>
                    </div>
                    <div class="nav-section-content">
                        <a href="1-1-scripting-overview.html" class="nav-link"><span class="nav-link-number">1.1</span> Scripting Overview</a>
                        <a href="1-2-choosing-right-tool.html" class="nav-link"><span class="nav-link-number">1.2</span> Choosing the Right Tool</a>
                        <a href="1-3-setting-up-environment.html" class="nav-link"><span class="nav-link-number">1.3</span> Setting Up Environment</a>
                    </div>
                </div>

                <!-- Section 2: PowerShell Deep Dive -->
                <div class="nav-section" data-section="powershell">
                    <div class="nav-section-header">
                        <span class="nav-section-icon">üî∑</span>
                        PowerShell Deep Dive
                        <span class="nav-section-toggle">‚ñº</span>
                    </div>
                    <div class="nav-section-content">
                        <a href="2-1-powershell-intro.html" class="nav-link"><span class="nav-link-number">2.1</span> PowerShell Introduction</a>
                        <a href="2-2-cmdlet-anatomy.html" class="nav-link"><span class="nav-link-number">2.2</span> Cmdlet Anatomy</a>
                        <a href="2-3-pipeline-mastery.html" class="nav-link"><span class="nav-link-number">2.3</span> Pipeline Mastery</a>
                        <a href="2-4-variables-data-types.html" class="nav-link"><span class="nav-link-number">2.4</span> Variables & Data Types</a>
                        <a href="2-5-working-with-objects.html" class="nav-link"><span class="nav-link-number">2.5</span> Working with Objects</a>
                        <a href="2-6-control-structures.html" class="nav-link"><span class="nav-link-number">2.6</span> Control Structures</a>
                        <a href="2-7-functions.html" class="nav-link"><span class="nav-link-number">2.7</span> Functions</a>
                        <a href="2-8-files.html" class="nav-link"><span class="nav-link-number">2.8</span> Working with Files</a>
                        <a href="2-9-wmi-cim.html" class="nav-link"><span class="nav-link-number">2.9</span> WMI & CIM</a>
                        <a href="2-10-registry.html" class="nav-link"><span class="nav-link-number">2.10</span> Registry Operations</a>
                        <a href="2-11-eventlog-analysis.html" class="nav-link"><span class="nav-link-number">2.11</span> Event Log Analysis</a>
                        <a href="2-12-active-directory.html" class="nav-link"><span class="nav-link-number">2.12</span> Active Directory</a>
                        <a href="2-13-networking-commands.html" class="nav-link"><span class="nav-link-number">2.13</span> Networking Commands</a>
                        <a href="2-14-web-requests.html" class="nav-link"><span class="nav-link-number">2.14</span> Web Requests & APIs</a>
                        <a href="2-15-remoting-jobs.html" class="nav-link"><span class="nav-link-number">2.15</span> Remoting & Jobs</a>
                        <a href="2-16-error-handling.html" class="nav-link"><span class="nav-link-number">2.16</span> Error Handling</a>
                        <a href="2-17-modules-profiles.html" class="nav-link"><span class="nav-link-number">2.17</span> Modules & Profiles</a>
                    </div>
                </div>

                <!-- Section 3: Bash Scripting -->
                <div class="nav-section" data-section="bash">
                    <div class="nav-section-header">
                        <span class="nav-section-icon">üêß</span>
                        Bash Scripting
                        <span class="nav-section-toggle">‚ñº</span>
                    </div>
                    <div class="nav-section-content">
                        <a href="3-1-bash-intro.html" class="nav-link"><span class="nav-link-number">3.1</span> Bash Introduction</a>
                        <a href="3-2-bash-variables.html" class="nav-link"><span class="nav-link-number">3.2</span> Variables & Data Types</a>
                        <a href="3-3-control-structures.html" class="nav-link"><span class="nav-link-number">3.3</span> Control Structures</a>
                        <a href="3-4-bash-functions.html" class="nav-link"><span class="nav-link-number">3.4</span> Functions & Scripts</a>
                        <a href="3-5-file-io.html" class="nav-link"><span class="nav-link-number">3.5</span> File I/O</a>
                        <a href="3-6-process-management.html" class="nav-link"><span class="nav-link-number">3.6</span> Process Management</a>
                        <a href="3-7-system-admin.html" class="nav-link"><span class="nav-link-number">3.7</span> System Administration</a>
                        <a href="3-8-regex.html" class="nav-link"><span class="nav-link-number">3.8</span> Regular Expressions</a>
                        <a href="3-9-text-processing.html" class="nav-link"><span class="nav-link-number">3.9</span> Text Processing</a>
                        <a href="3-10-bash-networking.html" class="nav-link"><span class="nav-link-number">3.10</span> Bash Networking</a>
                    </div>
                </div>

                <!-- Section 4: Batch/CMD Scripting -->
                <div class="nav-section" data-section="batch">
                    <div class="nav-section-header">
                        <span class="nav-section-icon">üì¶</span>
                        Batch/CMD Scripting
                        <span class="nav-section-toggle">‚ñº</span>
                    </div>
                    <div class="nav-section-content">
                        <a href="4-1-batch-intro.html" class="nav-link"><span class="nav-link-number">4.1</span> Batch Introduction</a>
                        <a href="4-2-batch-variables.html" class="nav-link"><span class="nav-link-number">4.2</span> Variables & Parameters</a>
                        <a href="4-3-batch-control-flow.html" class="nav-link"><span class="nav-link-number">4.3</span> Control Flow</a>
                        <a href="4-4-batch-file-operations.html" class="nav-link"><span class="nav-link-number">4.4</span> File Operations</a>
                    </div>
                </div>

                <!-- Section 5: Security Automation -->
                <div class="nav-section" data-section="security">
                    <div class="nav-section-header">
                        <span class="nav-section-icon">üõ°Ô∏è</span>
                        Security Automation
                        <span class="nav-section-toggle">‚ñº</span>
                    </div>
                    <div class="nav-section-content">
                        <a href="5-1-incident-response.html" class="nav-link"><span class="nav-link-number">5.1</span> Incident Response</a>
                        <a href="5-2-threat-hunting.html" class="nav-link"><span class="nav-link-number">5.2</span> Threat Hunting</a>
                        <a href="5-3-vulnerability-scanning.html" class="nav-link"><span class="nav-link-number">5.3</span> Vulnerability Scanning</a>
                        <a href="5-4-forensics-scripts.html" class="nav-link"><span class="nav-link-number">5.4</span> Forensics Scripts</a>
                        <a href="5-5-siem-integration.html" class="nav-link"><span class="nav-link-number">5.5</span> SIEM Integration</a>
                        <a href="5-6-edr-automation.html" class="nav-link"><span class="nav-link-number">5.6</span> EDR Automation</a>
                        <a href="5-7-compliance-automation.html" class="nav-link"><span class="nav-link-number">5.7</span> Compliance Automation</a>
                        <a href="5-8-log-analysis.html" class="nav-link"><span class="nav-link-number">5.8</span> Log Analysis</a>
                        <a href="5-9-malware-analysis.html" class="nav-link"><span class="nav-link-number">5.9</span> Malware Analysis</a>
                    </div>
                </div>

                <!-- Section 6: Python Scripting -->
                <div class="nav-section" data-section="python">
                    <div class="nav-section-header">
                        <span class="nav-section-icon">üêç</span>
                        Python Scripting
                        <span class="nav-section-toggle">‚ñº</span>
                    </div>
                    <div class="nav-section-content">
                        <a href="6-1-python-security-intro.html" class="nav-link"><span class="nav-link-number">6.1</span> Python for Security</a>
                        <a href="6-2-python-fundamentals.html" class="nav-link"><span class="nav-link-number">6.2</span> Python Fundamentals</a>
                        <a href="6-3-python-functions.html" class="nav-link"><span class="nav-link-number">6.3</span> Functions & Modules</a>
                        <a href="6-4-python-file-handling.html" class="nav-link"><span class="nav-link-number">6.4</span> File & Data Handling</a>
                        <a href="6-5-python-networking.html" class="nav-link"><span class="nav-link-number">6.5</span> Python Networking</a>
                        <a href="6-6-python-security-automation.html" class="nav-link"><span class="nav-link-number">6.6</span> Security Automation</a>
                        <a href="6-7-python-forensics.html" class="nav-link"><span class="nav-link-number">6.7</span> Forensics & Log Analysis</a>
                        <a href="6-8-python-apis.html" class="nav-link"><span class="nav-link-number">6.8</span> Python & APIs</a>
                    </div>
                </div>

                <!-- Section 7: Cloud Automation -->
                <div class="nav-section collapsed" data-section="cloud">
                    <div class="nav-section-header">
                        <span class="nav-section-icon">‚òÅÔ∏è</span>
                        Cloud Automation
                        <span class="nav-section-toggle">‚ñº</span>
                    </div>
                    <div class="nav-section-content">
                        <a href="7-1-azure-automation.html" class="nav-link"><span class="nav-link-number">7.1</span> Azure Automation</a>
                    </div>
                </div>

                <!-- Section 8: Real-World Projects -->
                <div class="nav-section collapsed" data-section="projects">
                    <div class="nav-section-header">
                        <span class="nav-section-icon">üöÄ</span>
                        Real-World Projects
                        <span class="nav-section-toggle">‚ñº</span>
                    </div>
                    <div class="nav-section-content">
                        <a href="8-1-security-dashboard.html" class="nav-link"><span class="nav-link-number">8.1</span> Security Dashboard</a>
                        <a href="8-2-log-aggregator.html" class="nav-link"><span class="nav-link-number">8.2</span> Log Aggregator</a>
                        <a href="8-3-asset-inventory.html" class="nav-link"><span class="nav-link-number">8.3</span> Asset Inventory</a>
                    </div>
                </div>

                <!-- Section 9: Troubleshooting -->
                <div class="nav-section collapsed" data-section="troubleshooting">
                    <div class="nav-section-header">
                        <span class="nav-section-icon">üîß</span>
                        Troubleshooting
                        <span class="nav-section-toggle">‚ñº</span>
                    </div>
                    <div class="nav-section-content">
                        <a href="9-1-common-errors.html" class="nav-link"><span class="nav-link-number">9.1</span> Common Errors</a>
                        <a href="9-2-debugging-techniques.html" class="nav-link"><span class="nav-link-number">9.2</span> Debugging Techniques</a>
                        <a href="9-3-performance-issues.html" class="nav-link"><span class="nav-link-number">9.3</span> Performance Issues</a>
                    </div>
                </div>

                <!-- Section 10: Reference -->
                <div class="nav-section collapsed" data-section="reference">
                    <div class="nav-section-header">
                        <span class="nav-section-icon">üìñ</span>
                        Reference
                        <span class="nav-section-toggle">‚ñº</span>
                    </div>
                    <div class="nav-section-content">
                        <a href="10-1-cheat-sheets.html" class="nav-link"><span class="nav-link-number">10.1</span> Cheat Sheets</a>
                        <a href="10-2-interview-preparation.html" class="nav-link"><span class="nav-link-number">10.2</span> Interview Preparation</a>
                        <a href="10-3-log-paths-reference.html" class="nav-link"><span class="nav-link-number">10.3</span> Log Paths Reference</a>
                    </div>
                </div>
            </nav>
        </aside>





        <!-- Main Content Area -->
        <main class="main-content">
            <div class="content-wrapper">
                <!-- Breadcrumb -->
                <nav class="breadcrumb">
                    <a href="index.html">Home</a>
                    <span class="breadcrumb-separator">‚Ä∫</span>
                    <a href="index.html#security">Security Automation</a>
                    <span class="breadcrumb-separator">‚Ä∫</span>
                    <span>Malware Analysis</span>
                </nav>

                <!-- Page Title -->
                <h1>5.9 Malware Analysis Scripts</h1>

                <!-- What You'll Learn Box -->
                <div class="info-box overview-box">
                    <div class="info-box-header">
                        <div class="info-box-icon">üìñ</div>
                        <div class="info-box-title">What You'll Learn</div>
                    </div>
                    <ul>
                        <li>Extract file metadata and indicators</li>
                        <li>Analyze suspicious files safely</li>
                        <li>Query threat intelligence APIs</li>
                        <li>Automate IOC extraction</li>
                    </ul>
                </div>

                <!-- Warning -->
                <div class="info-box critical-box">
                    <div class="info-box-header">
                        <div class="info-box-icon">‚ö†Ô∏è</div>
                        <div class="info-box-title">Safety Warning</div>
                    </div>
                    <p>Always analyze malware in isolated environments (VMs with snapshots, air-gapped systems). Never run suspicious files on production systems. These scripts are for static analysis and metadata extraction only.</p>
                </div>

                <!-- File Analysis -->
                <h2>File Metadata Analysis</h2>

                <div class="code-container">
                    <div class="code-header">
                        <span class="code-language powershell">
                            <span class="code-language-icon">üî∑</span>
                            PowerShell - File Analysis
                        </span>
                        <button class="code-copy-btn"><span>üìã</span> Copy</button>
                    </div>
                    <div class="code-block">
<pre><code><span class="token-keyword">function</span> <span class="token-function">Get-FileAnalysis</span> {
    <span class="token-comment">&lt;#
    .SYNOPSIS
        Performs static analysis on a file.
    #&gt;</span>
    [CmdletBinding()]
    <span class="token-keyword">param</span>(
        [Parameter(Mandatory)]
        [string]<span class="token-variable">$FilePath</span>
    )
    
    <span class="token-keyword">if</span> (-not (<span class="token-cmdlet">Test-Path</span> <span class="token-variable">$FilePath</span>)) {
        Write-Error <span class="token-string">"File not found: $FilePath"</span>
        <span class="token-keyword">return</span>
    }
    
    <span class="token-variable">$File</span> = <span class="token-cmdlet">Get-Item</span> <span class="token-variable">$FilePath</span>
    <span class="token-variable">$Bytes</span> = [System.IO.File]::ReadAllBytes(<span class="token-variable">$FilePath</span>)
    
    <span class="token-comment"># Calculate hashes</span>
    <span class="token-variable">$MD5</span> = (<span class="token-cmdlet">Get-FileHash</span> <span class="token-variable">$FilePath</span> <span class="token-parameter">-Algorithm</span> MD5).Hash
    <span class="token-variable">$SHA1</span> = (<span class="token-cmdlet">Get-FileHash</span> <span class="token-variable">$FilePath</span> <span class="token-parameter">-Algorithm</span> SHA1).Hash
    <span class="token-variable">$SHA256</span> = (<span class="token-cmdlet">Get-FileHash</span> <span class="token-variable">$FilePath</span> <span class="token-parameter">-Algorithm</span> SHA256).Hash
    
    <span class="token-comment"># Get magic bytes (file signature)</span>
    <span class="token-variable">$MagicBytes</span> = (<span class="token-variable">$Bytes</span>[0..3] | <span class="token-cmdlet">ForEach-Object</span> { <span class="token-variable">$_</span>.ToString(<span class="token-string">'X2'</span>) }) -join <span class="token-string">' '</span>
    
    <span class="token-comment"># Determine file type from magic bytes</span>
    <span class="token-variable">$FileType</span> = <span class="token-keyword">switch</span> (<span class="token-variable">$MagicBytes</span>) {
        <span class="token-string">'4D 5A 90 00'</span> { <span class="token-string">'PE Executable (EXE/DLL)'</span> }
        <span class="token-string">'50 4B 03 04'</span> { <span class="token-string">'ZIP/Office Document'</span> }
        <span class="token-string">'25 50 44 46'</span> { <span class="token-string">'PDF Document'</span> }
        <span class="token-string">'D0 CF 11 E0'</span> { <span class="token-string">'OLE Compound (DOC/XLS)'</span> }
        <span class="token-string">'7F 45 4C 46'</span> { <span class="token-string">'ELF Executable (Linux)'</span> }
        <span class="token-string">'CA FE BA BE'</span> { <span class="token-string">'Java Class/Mach-O'</span> }
        default { <span class="token-string">'Unknown'</span> }
    }
    
    <span class="token-comment"># Check for PE file</span>
    <span class="token-variable">$IsPE</span> = <span class="token-variable">$Bytes</span>[0] <span class="token-operator">-eq</span> <span class="token-number">0x4D</span> <span class="token-operator">-and</span> <span class="token-variable">$Bytes</span>[1] <span class="token-operator">-eq</span> <span class="token-number">0x5A</span>
    
    <span class="token-comment"># Get digital signature</span>
    <span class="token-variable">$Signature</span> = <span class="token-cmdlet">Get-AuthenticodeSignature</span> <span class="token-variable">$FilePath</span>
    
    [PSCustomObject]@{
        FileName = <span class="token-variable">$File</span>.Name
        FullPath = <span class="token-variable">$File</span>.FullName
        Size = <span class="token-string">"$([math]::Round($File.Length / 1KB, 2)) KB"</span>
        Created = <span class="token-variable">$File</span>.CreationTime
        Modified = <span class="token-variable">$File</span>.LastWriteTime
        MagicBytes = <span class="token-variable">$MagicBytes</span>
        FileType = <span class="token-variable">$FileType</span>
        MD5 = <span class="token-variable">$MD5</span>
        SHA1 = <span class="token-variable">$SHA1</span>
        SHA256 = <span class="token-variable">$SHA256</span>
        IsSigned = <span class="token-variable">$Signature</span>.Status <span class="token-operator">-eq</span> <span class="token-string">'Valid'</span>
        SignerCertificate = <span class="token-variable">$Signature</span>.SignerCertificate.Subject
        SignatureStatus = <span class="token-variable">$Signature</span>.Status
    }
}

<span class="token-comment"># Example usage</span>
<span class="token-comment"># Get-FileAnalysis -FilePath "C:\Samples\suspicious.exe"</span></code></pre>
                    </div>
                </div>

                <!-- String Extraction -->
                <h2>String Extraction</h2>

                <div class="code-container">
                    <div class="code-header">
                        <span class="code-language powershell">
                            <span class="code-language-icon">üî∑</span>
                            PowerShell - Extract Strings
                        </span>
                        <button class="code-copy-btn"><span>üìã</span> Copy</button>
                    </div>
                    <div class="code-block">
<pre><code><span class="token-keyword">function</span> <span class="token-function">Get-FileStrings</span> {
    <span class="token-comment">&lt;#
    .SYNOPSIS
        Extracts readable strings from a binary file.
    #&gt;</span>
    [CmdletBinding()]
    <span class="token-keyword">param</span>(
        [Parameter(Mandatory)]
        [string]<span class="token-variable">$FilePath</span>,
        [int]<span class="token-variable">$MinLength</span> = <span class="token-number">4</span>
    )
    
    <span class="token-variable">$Content</span> = [System.IO.File]::ReadAllBytes(<span class="token-variable">$FilePath</span>)
    <span class="token-variable">$StringBuilder</span> = [System.Text.StringBuilder]::new()
    <span class="token-variable">$Strings</span> = @()
    
    <span class="token-keyword">foreach</span> (<span class="token-variable">$Byte</span> <span class="token-keyword">in</span> <span class="token-variable">$Content</span>) {
        <span class="token-comment"># Printable ASCII range</span>
        <span class="token-keyword">if</span> (<span class="token-variable">$Byte</span> <span class="token-operator">-ge</span> <span class="token-number">32</span> <span class="token-operator">-and</span> <span class="token-variable">$Byte</span> <span class="token-operator">-le</span> <span class="token-number">126</span>) {
            [void]<span class="token-variable">$StringBuilder</span>.Append([char]<span class="token-variable">$Byte</span>)
        } <span class="token-keyword">else</span> {
            <span class="token-keyword">if</span> (<span class="token-variable">$StringBuilder</span>.Length <span class="token-operator">-ge</span> <span class="token-variable">$MinLength</span>) {
                <span class="token-variable">$Strings</span> += <span class="token-variable">$StringBuilder</span>.ToString()
            }
            [void]<span class="token-variable">$StringBuilder</span>.Clear()
        }
    }
    
    <span class="token-variable">$Strings</span>
}

<span class="token-comment"># Find suspicious strings</span>
<span class="token-keyword">function</span> <span class="token-function">Find-SuspiciousStrings</span> {
    <span class="token-keyword">param</span>(
        [Parameter(Mandatory)]
        [string]<span class="token-variable">$FilePath</span>
    )
    
    <span class="token-variable">$SuspiciousPatterns</span> = @(
        <span class="token-string">'http://'</span>, <span class="token-string">'https://'</span>,
        <span class="token-string">'cmd.exe'</span>, <span class="token-string">'powershell'</span>,
        <span class="token-string">'reg add'</span>, <span class="token-string">'reg delete'</span>,
        <span class="token-string">'CreateRemoteThread'</span>, <span class="token-string">'VirtualAlloc'</span>,
        <span class="token-string">'WriteProcessMemory'</span>, <span class="token-string">'LoadLibrary'</span>,
        <span class="token-string">'WScript.Shell'</span>, <span class="token-string">'Shell.Application'</span>,
        <span class="token-string">'HKEY_'</span>, <span class="token-string">'CurrentVersion\Run'</span>,
        <span class="token-string">'schtasks'</span>, <span class="token-string">'at.exe'</span>,
        <span class="token-string">'password'</span>, <span class="token-string">'credential'</span>,
        <span class="token-string">'mimikatz'</span>, <span class="token-string">'sekurlsa'</span>,
        <span class="token-string">'.onion'</span>, <span class="token-string">'tor2web'</span>
    )
    
    <span class="token-variable">$AllStrings</span> = Get-FileStrings <span class="token-parameter">-FilePath</span> <span class="token-variable">$FilePath</span>
    <span class="token-variable">$Findings</span> = @()
    
    <span class="token-keyword">foreach</span> (<span class="token-variable">$String</span> <span class="token-keyword">in</span> <span class="token-variable">$AllStrings</span>) {
        <span class="token-keyword">foreach</span> (<span class="token-variable">$Pattern</span> <span class="token-keyword">in</span> <span class="token-variable">$SuspiciousPatterns</span>) {
            <span class="token-keyword">if</span> (<span class="token-variable">$String</span> <span class="token-operator">-like</span> <span class="token-string">"*$Pattern*"</span>) {
                <span class="token-variable">$Findings</span> += [PSCustomObject]@{
                    Pattern = <span class="token-variable">$Pattern</span>
                    String = <span class="token-variable">$String</span>
                }
            }
        }
    }
    
    <span class="token-variable">$Findings</span> | <span class="token-cmdlet">Sort-Object</span> Pattern <span class="token-parameter">-Unique</span>
}</code></pre>
                    </div>
                </div>

                <!-- IOC Extraction -->
                <h2>IOC Extraction</h2>

                <div class="code-container">
                    <div class="code-header">
                        <span class="code-language powershell">
                            <span class="code-language-icon">üî∑</span>
                            PowerShell - Extract IOCs
                        </span>
                        <button class="code-copy-btn"><span>üìã</span> Copy</button>
                    </div>
                    <div class="code-block">
<pre><code><span class="token-keyword">function</span> <span class="token-function">Get-IOCsFromFile</span> {
    <span class="token-comment">&lt;#
    .SYNOPSIS
        Extracts Indicators of Compromise from a file.
    #&gt;</span>
    [CmdletBinding()]
    <span class="token-keyword">param</span>(
        [Parameter(Mandatory)]
        [string]<span class="token-variable">$FilePath</span>
    )
    
    <span class="token-variable">$Content</span> = <span class="token-cmdlet">Get-Content</span> <span class="token-variable">$FilePath</span> <span class="token-parameter">-Raw</span> -ErrorAction SilentlyContinue
    <span class="token-keyword">if</span> (-not <span class="token-variable">$Content</span>) {
        <span class="token-variable">$Content</span> = (Get-FileStrings <span class="token-variable">$FilePath</span>) -join <span class="token-string">"`n"</span>
    }
    
    <span class="token-variable">$IOCs</span> = [PSCustomObject]@{
        IPs = @()
        Domains = @()
        URLs = @()
        Emails = @()
        Hashes = @()
        RegistryKeys = @()
        FilePaths = @()
    }
    
    <span class="token-comment"># IPv4 addresses</span>
    <span class="token-variable">$IPPattern</span> = <span class="token-string">'\b(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\b'</span>
    <span class="token-variable">$IOCs</span>.IPs = ([regex]::Matches(<span class="token-variable">$Content</span>, <span class="token-variable">$IPPattern</span>)).Value | <span class="token-cmdlet">Sort-Object</span> <span class="token-parameter">-Unique</span>
    
    <span class="token-comment"># URLs</span>
    <span class="token-variable">$URLPattern</span> = <span class="token-string">'https?://[^\s"''&lt;&gt;]+'</span>
    <span class="token-variable">$IOCs</span>.URLs = ([regex]::Matches(<span class="token-variable">$Content</span>, <span class="token-variable">$URLPattern</span>)).Value | <span class="token-cmdlet">Sort-Object</span> <span class="token-parameter">-Unique</span>
    
    <span class="token-comment"># Domains (basic pattern)</span>
    <span class="token-variable">$DomainPattern</span> = <span class="token-string">'\b[a-zA-Z0-9][-a-zA-Z0-9]*\.[a-zA-Z]{2,}\b'</span>
    <span class="token-variable">$IOCs</span>.Domains = ([regex]::Matches(<span class="token-variable">$Content</span>, <span class="token-variable">$DomainPattern</span>)).Value | 
        <span class="token-cmdlet">Where-Object</span> { <span class="token-variable">$_</span> <span class="token-operator">-notmatch</span> <span class="token-string">'\.dll$|\.exe$|\.sys$'</span> } |
        <span class="token-cmdlet">Sort-Object</span> <span class="token-parameter">-Unique</span>
    
    <span class="token-comment"># Email addresses</span>
    <span class="token-variable">$EmailPattern</span> = <span class="token-string">'[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}'</span>
    <span class="token-variable">$IOCs</span>.Emails = ([regex]::Matches(<span class="token-variable">$Content</span>, <span class="token-variable">$EmailPattern</span>)).Value | <span class="token-cmdlet">Sort-Object</span> <span class="token-parameter">-Unique</span>
    
    <span class="token-comment"># MD5 hashes</span>
    <span class="token-variable">$MD5Pattern</span> = <span class="token-string">'\b[A-Fa-f0-9]{32}\b'</span>
    <span class="token-variable">$SHA256Pattern</span> = <span class="token-string">'\b[A-Fa-f0-9]{64}\b'</span>
    <span class="token-variable">$IOCs</span>.Hashes = ([regex]::Matches(<span class="token-variable">$Content</span>, <span class="token-variable">$MD5Pattern</span>)).Value + 
        ([regex]::Matches(<span class="token-variable">$Content</span>, <span class="token-variable">$SHA256Pattern</span>)).Value | <span class="token-cmdlet">Sort-Object</span> <span class="token-parameter">-Unique</span>
    
    <span class="token-comment"># Registry keys</span>
    <span class="token-variable">$RegPattern</span> = <span class="token-string">'HKEY_[A-Z_]+\\[^\s"''&lt;&gt;]+'</span>
    <span class="token-variable">$IOCs</span>.RegistryKeys = ([regex]::Matches(<span class="token-variable">$Content</span>, <span class="token-variable">$RegPattern</span>)).Value | <span class="token-cmdlet">Sort-Object</span> <span class="token-parameter">-Unique</span>
    
    <span class="token-comment"># Windows file paths</span>
    <span class="token-variable">$PathPattern</span> = <span class="token-string">'[A-Za-z]:\\[^\s"''&lt;&gt;:*?|]+'</span>
    <span class="token-variable">$IOCs</span>.FilePaths = ([regex]::Matches(<span class="token-variable">$Content</span>, <span class="token-variable">$PathPattern</span>)).Value | <span class="token-cmdlet">Sort-Object</span> <span class="token-parameter">-Unique</span>
    
    <span class="token-variable">$IOCs</span>
}</code></pre>
                    </div>
                </div>

                <!-- VirusTotal Integration -->
                <h2>VirusTotal API Integration</h2>

                <div class="code-container">
                    <div class="code-header">
                        <span class="code-language powershell">
                            <span class="code-language-icon">üî∑</span>
                            PowerShell - VirusTotal Lookup
                        </span>
                        <button class="code-copy-btn"><span>üìã</span> Copy</button>
                    </div>
                    <div class="code-block">
<pre><code><span class="token-keyword">function</span> <span class="token-function">Get-VirusTotalReport</span> {
    <span class="token-comment">&lt;#
    .SYNOPSIS
        Queries VirusTotal for a file hash.
    .NOTES
        Requires free VirusTotal API key from virustotal.com
    #&gt;</span>
    [CmdletBinding()]
    <span class="token-keyword">param</span>(
        [Parameter(Mandatory)]
        [string]<span class="token-variable">$Hash</span>,
        
        [Parameter(Mandatory)]
        [string]<span class="token-variable">$ApiKey</span>
    )
    
    <span class="token-variable">$Uri</span> = <span class="token-string">"https://www.virustotal.com/api/v3/files/$Hash"</span>
    
    <span class="token-variable">$Headers</span> = @{
        <span class="token-string">'x-apikey'</span> = <span class="token-variable">$ApiKey</span>
    }
    
    <span class="token-keyword">try</span> {
        <span class="token-variable">$Response</span> = <span class="token-cmdlet">Invoke-RestMethod</span> <span class="token-parameter">-Uri</span> <span class="token-variable">$Uri</span> <span class="token-parameter">-Headers</span> <span class="token-variable">$Headers</span> <span class="token-parameter">-Method</span> Get
        
        <span class="token-variable">$Stats</span> = <span class="token-variable">$Response</span>.data.attributes.last_analysis_stats
        
        [PSCustomObject]@{
            Hash = <span class="token-variable">$Hash</span>
            FileName = <span class="token-variable">$Response</span>.data.attributes.meaningful_name
            FileType = <span class="token-variable">$Response</span>.data.attributes.type_description
            Size = <span class="token-variable">$Response</span>.data.attributes.size
            FirstSeen = <span class="token-variable">$Response</span>.data.attributes.first_submission_date
            LastAnalysis = <span class="token-variable">$Response</span>.data.attributes.last_analysis_date
            Malicious = <span class="token-variable">$Stats</span>.malicious
            Suspicious = <span class="token-variable">$Stats</span>.suspicious
            Harmless = <span class="token-variable">$Stats</span>.harmless
            Undetected = <span class="token-variable">$Stats</span>.undetected
            DetectionRatio = <span class="token-string">"$($Stats.malicious)/$($Stats.malicious + $Stats.undetected)"</span>
            VTLink = <span class="token-string">"https://www.virustotal.com/gui/file/$Hash"</span>
        }
    } <span class="token-keyword">catch</span> {
        <span class="token-keyword">if</span> (<span class="token-variable">$_</span>.Exception.Response.StatusCode <span class="token-operator">-eq</span> <span class="token-number">404</span>) {
            Write-Host <span class="token-string">"Hash not found in VirusTotal"</span> -ForegroundColor Yellow
        } <span class="token-keyword">else</span> {
            Write-Error <span class="token-string">"VT API Error: $_"</span>
        }
    }
}

<span class="token-comment"># Batch check multiple hashes</span>
<span class="token-keyword">function</span> <span class="token-function">Get-VTBatchReport</span> {
    <span class="token-keyword">param</span>(
        [string[]]<span class="token-variable">$Hashes</span>,
        [string]<span class="token-variable">$ApiKey</span>
    )
    
    <span class="token-keyword">foreach</span> (<span class="token-variable">$Hash</span> <span class="token-keyword">in</span> <span class="token-variable">$Hashes</span>) {
        Get-VirusTotalReport <span class="token-parameter">-Hash</span> <span class="token-variable">$Hash</span> <span class="token-parameter">-ApiKey</span> <span class="token-variable">$ApiKey</span>
        <span class="token-comment"># Rate limiting (4 requests/min for free tier)</span>
        Start-Sleep <span class="token-parameter">-Seconds</span> <span class="token-number">16</span>
    }
}</code></pre>
                    </div>
                </div>

                <!-- PE Analysis -->
                <h2>PE File Analysis</h2>

                <div class="code-container">
                    <div class="code-header">
                        <span class="code-language powershell">
                            <span class="code-language-icon">üî∑</span>
                            PowerShell - PE Header Analysis
                        </span>
                        <button class="code-copy-btn"><span>üìã</span> Copy</button>
                    </div>
                    <div class="code-block">
<pre><code><span class="token-keyword">function</span> <span class="token-function">Get-PEInfo</span> {
    <span class="token-comment">&lt;#
    .SYNOPSIS
        Extracts PE header information.
    #&gt;</span>
    [CmdletBinding()]
    <span class="token-keyword">param</span>(
        [Parameter(Mandatory)]
        [string]<span class="token-variable">$FilePath</span>
    )
    
    <span class="token-variable">$Bytes</span> = [System.IO.File]::ReadAllBytes(<span class="token-variable">$FilePath</span>)
    
    <span class="token-comment"># Check MZ header</span>
    <span class="token-keyword">if</span> (<span class="token-variable">$Bytes</span>[0] <span class="token-operator">-ne</span> <span class="token-number">0x4D</span> <span class="token-operator">-or</span> <span class="token-variable">$Bytes</span>[1] <span class="token-operator">-ne</span> <span class="token-number">0x5A</span>) {
        Write-Error <span class="token-string">"Not a valid PE file"</span>
        <span class="token-keyword">return</span>
    }
    
    <span class="token-comment"># Get PE header offset from DOS header</span>
    <span class="token-variable">$PEOffset</span> = [BitConverter]::ToInt32(<span class="token-variable">$Bytes</span>, <span class="token-number">0x3C</span>)
    
    <span class="token-comment"># Machine type</span>
    <span class="token-variable">$MachineType</span> = [BitConverter]::ToUInt16(<span class="token-variable">$Bytes</span>, <span class="token-variable">$PEOffset</span> + <span class="token-number">4</span>)
    <span class="token-variable">$Architecture</span> = <span class="token-keyword">switch</span> (<span class="token-variable">$MachineType</span>) {
        <span class="token-number">0x14c</span>  { <span class="token-string">'x86 (32-bit)'</span> }
        <span class="token-number">0x8664</span> { <span class="token-string">'x64 (64-bit)'</span> }
        <span class="token-number">0x1c0</span>  { <span class="token-string">'ARM'</span> }
        default { <span class="token-string">"Unknown (0x$($MachineType.ToString('X4')))"</span> }
    }
    
    <span class="token-comment"># Timestamp</span>
    <span class="token-variable">$TimestampRaw</span> = [BitConverter]::ToUInt32(<span class="token-variable">$Bytes</span>, <span class="token-variable">$PEOffset</span> + <span class="token-number">8</span>)
    <span class="token-variable">$Timestamp</span> = (Get-Date <span class="token-string">"1970-01-01"</span>).AddSeconds(<span class="token-variable">$TimestampRaw</span>)
    
    <span class="token-comment"># Number of sections</span>
    <span class="token-variable">$NumSections</span> = [BitConverter]::ToUInt16(<span class="token-variable">$Bytes</span>, <span class="token-variable">$PEOffset</span> + <span class="token-number">6</span>)
    
    <span class="token-comment"># Get imports using .NET reflection</span>
    <span class="token-variable">$Assembly</span> = [System.Reflection.Assembly]::LoadFile(<span class="token-variable">$FilePath</span>)
    <span class="token-variable">$Imports</span> = <span class="token-variable">$Assembly</span>.GetReferencedAssemblies() | <span class="token-cmdlet">Select-Object</span> <span class="token-parameter">-ExpandProperty</span> Name
    
    [PSCustomObject]@{
        FileName = <span class="token-cmdlet">Split-Path</span> <span class="token-variable">$FilePath</span> <span class="token-parameter">-Leaf</span>
        Architecture = <span class="token-variable">$Architecture</span>
        CompileTime = <span class="token-variable">$Timestamp</span>
        Sections = <span class="token-variable">$NumSections</span>
        IsDotNet = <span class="token-variable">$null</span> <span class="token-operator">-ne</span> <span class="token-variable">$Assembly</span>
    }
}</code></pre>
                    </div>
                </div>

                <!-- Memory Aid -->
                <div class="info-box memory-box">
                    <div class="info-box-header">
                        <div class="info-box-icon">üß†</div>
                        <div class="info-box-title">Memory Aid: Magic Bytes</div>
                    </div>
                    <ul>
                        <li><strong>4D 5A</strong> ‚Üí PE (MZ header) - EXE/DLL</li>
                        <li><strong>50 4B</strong> ‚Üí ZIP/DOCX/XLSX/JAR</li>
                        <li><strong>25 50 44 46</strong> ‚Üí PDF (%PDF)</li>
                        <li><strong>D0 CF 11 E0</strong> ‚Üí OLE (DOC/XLS/PPT)</li>
                        <li><strong>7F 45 4C 46</strong> ‚Üí ELF (Linux executable)</li>
                        <li><strong>FF D8 FF</strong> ‚Üí JPEG image</li>
                    </ul>
                </div>

                <!-- Best Practices -->
                <div class="info-box best-practice-box">
                    <div class="info-box-header">
                        <div class="info-box-icon">‚úÖ</div>
                        <div class="info-box-title">Best Practices: Malware Analysis</div>
                    </div>
                    <ul>
                        <li><strong>Use isolated VMs:</strong> Never on production systems</li>
                        <li><strong>Take snapshots:</strong> Before and after analysis</li>
                        <li><strong>Start with static analysis:</strong> Hashes, strings, metadata</li>
                        <li><strong>Check multiple sources:</strong> VT, Hybrid Analysis, etc.</li>
                        <li><strong>Document findings:</strong> IOCs, behaviors, timestamps</li>
                        <li><strong>Share responsibly:</strong> Follow disclosure practices</li>
                    </ul>
                </div>

                <!-- Interview Tips -->
                <div class="info-box interview-box">
                    <div class="info-box-header">
                        <div class="info-box-icon">üíº</div>
                        <div class="info-box-title">Interview Tips</div>
                    </div>
                    <ul>
                        <li><strong>Common Question:</strong> "Walk me through your malware analysis process."</li>
                        <li><strong>Strong Answer:</strong> Start with static analysis in an isolated VM‚Äîcalculate hashes, check VirusTotal, extract strings and IOCs. Look at magic bytes to verify file type, examine PE headers for compilation time and imports. Search for suspicious strings (URLs, registry keys, API calls). Only proceed to dynamic analysis (sandbox) if static is insufficient, monitoring network and file system changes.</li>
                    </ul>
                </div>

                <!-- Key Takeaways -->
                <h2>Key Takeaways</h2>
                <ul>
                    <li>Calculate multiple hashes (MD5, SHA1, SHA256) for lookups</li>
                    <li>Extract strings to find URLs, IPs, commands</li>
                    <li>Check magic bytes to verify actual file type</li>
                    <li>Use VirusTotal API for reputation checks</li>
                    <li>Always analyze in isolated environments</li>
                    <li>Document and share IOCs responsibly</li>
                </ul>

                <!-- Navigation -->
                                <div class="page-navigation">
                    <a href="5-8-log-analysis.html" class="nav-button prev">
                        <span class="nav-button-label">Previous</span>
                        <span class="nav-button-title">‚Üê 5.8 Log Analysis</span>
                    </a>
                    <a href="6-1-python-security-intro.html" class="nav-button next">
                        <span class="nav-button-label">Next</span>
                        <span class="nav-button-title">6.1 Python for Security ‚Üí</span>
                    </a>
                </div>
            </div>
        </main>

    <div class="search-modal" id="searchModal">
        <div class="search-modal-content">
            <input type="text" class="search-modal-input" id="searchModalInput" placeholder="Search documentation..." autocomplete="off">
            <div class="search-modal-results" id="searchResults"></div>
        </div>
    </div>

    <button class="mobile-toggle">‚ò∞</button>
    <script src="main.js"></script>
</body>
</html>
